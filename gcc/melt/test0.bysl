;; -*- lisp -*-


(defprimitive boxint (:long i) :value 
  "basilysgc_new_int( BASILYSGOB(DISCR_INTEGER), (" i "))"
)

(defprimitive is_integerbox (ib) :long
  "(basilys_magic_discr((" ib ")) == OBMAG_INT)")

(defun constfunbox0 () (boxint 0))

(defun constnil () ())

(defun testconstbox1 (xx) (if (is_integerbox xx) (boxint 2) ()))


(defclass my_class_root 
 :predef CLASS_ROOT
 :fields (root_f1 ; root_f2
		  ))

(defclass my_class_named
  :super my_class_root
  :fields (my_name)
)

(defclass my_class_selector
  :super my_class_named
  :predef CLASS_SELECTOR
  :fields (
))

(defselector the_sel my_class_selector
)




(defun testunsafegetputnameprogn (o n) 
  (let ( (oldn (unsafe_get_field :my_name o)) )
    (progn 
      (unsafe_put_fields o :my_name n) 
      oldn)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
#| ; SKIPPING
(defun testsendsel (f x) 
  (the_sel (f x) 
	   (boxint 789)
	   x
	   246))

(defun testmultisend (g y)
  (multicall (u v)
	     (the_sel 
	      (g y y) 
	      the_sel 1357)
	     (g u v)
	     ))

(definstance ii my_class_root 
  :root_f1 (boxint 1001002))

(defprimitive gti (:long a b) :long 
  "((" a ")>(" b "))")

(defprimitive puts (:cstring s) :void "puts(" s ")")

(defun foo (x :long n) 
  (if
      (gti n 0) 
      x 
    (boxint n)))

(defun bar (y)
  (if y
      (foo y 123)
    (boxint 456)))

(defun testforever (z)
  (forever loop
	   (exit loop (bar z))))
 
(defun testmulticall (f g x)
  (multicall 
   (r1 r2) 
   (g x)
   (f r1 r2)))



(if foo 
    (puts "has foo"))

(if boxint 
    (puts "has boxint"))

(puts "end test0")

; SKIPPED |#