2012-03-26   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): Use timer TV_PPH.
	(pph_init): Likewise.
	(pph_finish): Likewise.
	* pph-in.c (pph_in_line_table_and_includes): Use timer
	TV_PPH_RESTORE_LINE_TABLE.
	(pph_in_replay): Use timer TV_PPH_RESTORE_REPLAY.
	(pph_in_identifiers): Use timer TV_PPH_RESTORE_IDENTIFIERS.
	(pph_in_global_binding_keys): Use timer
	TV_PPH_RESTORE_MERGE_KEYS.
	(pph_in_global_binding_bodies): Use timer
	TV_PPH_RESTORE_MERGE_BODIES.
	(pph_read_file_1): Use timer TV_PPH_RESTORE_MISC and timer
	TV_PPH_VALIDATE_IDENTIFIERS.
	(pph_read_file): Use timer TV_PPH_RESTORE.
	* pph-out.c (pph_writer_init): Use timer TV_PPH_SAVE.
	(pph_out_line_table_and_includes): Use timer
	TV_PPH_SAVE_LINE_TABLE.
	(pph_out_replay): Use timer TV_PPH_SAVE_REPLAY.
	(pph_out_identifiers): Use timer TV_PPH_SAVE_IDENTIFIERS.
	(pph_out_global_binding_keys): Use timer TV_PPH_SAVE_MERGE_KEYS.
	(pph_out_global_binding_bodies): Use timer TV_PPH_SAVE_MERGE_BODIES.
	(pph_write_file): Use timer TV_PPH_SAVE_MISC.
	(pph_writer_finish): Use timer TV_PPH_SAVE.
	* pt.c (pph_in_bodies_spec_entry_htab): Use timer
	TV_PPH_RESTORE_MERGE_BODIES.
	(pph_out_merge_key_template_state): Use timer TV_PPH_SAVE_MERGE_KEYS.
	(pph_out_merge_body_template_state): Use timer TV_PPH_SAVE_MERGE_BODIES.
	(pph_in_merge_key_template_state): Use timer TV_PPH_RESTORE_MERGE_KEYS.
	(pph_in_merge_body_template_state): Use timer
	TV_PPH_RESTORE_MERGE_BODIES.

2012-03-25   Diego Novillo  <dnovillo@google.com>

	* pph-out.c (pph_out_global_binding_keys): Fix check for empty
	statement list.

2012-03-25   Diego Novillo  <dnovillo@google.com>

	* mangle.c (write_expression): Handle TRAIT_EXPR when PPH is enabled.
	(write_template_arg_literal): Handle CONST_DECLs that do not have
	a constant DECL_INITIAL when PPH is enabled.

2012-03-23   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_set_identifier_binding): If DECL is a USING_DECL,
	register the TYPE_DECL it is referring to.
	(pph_set_namespace_decl_binding): Remove previous hack that skipped
	USING_DECLs.

2012-03-22   Lawrence Crowl  <crowl@google.com>

	* error.c (dump_location_qualifier):  Add qualifier using
	TEMPLATE_PARM_NUM_SIBLINGS.  Rename to dump_tmpl_type_parm_qualifier.
	(dump_tmpl_type_parm_qualifier): Renamed from above.
	(dump_type): Change call of dump_location_qualifier to
	dump_tmpl_type_parm_qualifier.
	* pt.c (pph_out_pending_templates_list):  Add more debugging output.
	(pph_in_pending_templates_list):  Move debugging output.
	(pph_out_spec_entry_htab):  Add more debugging output.
	* parser.c (cp_debug_parser_where):  Fix comment.
	(cp_debug_the_parser_where):  New.
	* parser.h (cp_debug_the_parser_where): New.

2012-03-21   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_set_namespace_decl_binding): Ignore
	USING_DECLs.

2012-03-19   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (struct pph_replay_entry): Rename from
	pph_symtab_entry.
	Rename field DECL to TO_REPLAY.
	Update all users.
	(struct pph_replay): Rename from pph_symtab.
	(enum pph_replay_action): Rename from pph_symtab_action.

2012-03-19   Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/class.o): Add dependency on PPH_H.
	* class.c (finish_struct_methods): If pph_writer_enabled_p
	returns true, call pph_add_type_to_symtab.
	* pph-in.c (pph_in_tcc_type): Do not call finish_struct_methods.
	(pph_in_symtab_action): Handle PPH_SYMTAB_FINISH_STRUCT_METHODS.
	(pph_in_symtab): Likewise.
	* pph-out.c (pph_out_symtab_action): Likewise.
	(pph_add_type_to_symtab): New.
	* pph.h (enum pph_symtab_action): Add PPH_SYMTAB_FINISH_STRUCT_METHODS.
	(pph_add_type_to_symtab): Declare.

2012-03-17   Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_lexer_print_token): Protect against NULL
	values in CPP_NAME tokens.

2012-03-16   Lawrence Crowl  <crowl@google.com>

	* cp-tree.h (make_anon_name): Add location parameter.
	* name-lookup.c (static const char anon_char): New.
	(static const char anon_prefix): New.
	(edit_anon_name): New.
	(make_anon_name): Add location parameter.  Use location in creating
	names for anonymous (tagless) types when using PPH.
	(make_lambda_name): Fix comment for later.
	* class.c (layout_class_type): Pass location to make_anon_name.
	* decl.c (start_enum): Pass location to make_anon_name.
	* semantics.c (finish_compound_literal): Pass location to
	make_anon_name.
	(begin_class_definition): Pass location to make_anon_name.
	* error.c (dump_type): Protect call against null pointer.
	* parser.c (cp_lexer_print_token): Protect against null values.
	(cp_parser_enum_specifier): Pass location to make_anon_name.
	(cp_parser_class_head): Pass location to make_anon_name.

2012-03-15   Lawrence Crowl  <crowl@google.com>

	* pph.h (pph_check_main_guarded): New.
	* pph-core.c (pph_check_main_guarded): New.
	* pph-out.c (pph_writer_finish): Factor out guard check into
	pph_check_main_guarded.
	* parser.c (c_parse_file): Add guard check for non-pph compiles.

2012-03-14   Diego Novillo  <dnovillo@google.com>

	* parser.c (the_lexer): Declare.
	(cp_lexer_new_main): Initialize.
	(c_parse_file): Set to NULL.

2012-03-14   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_merge_key_tree_with_searcher): Detect and
	diagnose attempts to merge two distinct trees from the same
	PPH image.

2012-03-13   Diego Novillo  <dnovillo@google.com>

	* decl.c (cp_rest_of_decl_compilation): When generating a PPH
	file, call pph_add_decl_to_symtab and return.
	* pph-core.c (tag_strings): Remove "PPH_cgraph_node".
	* pph-in.c (pph_in_merge_ld_base): Merge
	ldb->not_really_extern with |=.
	(pph_in_merge_lang_indep_tree_body): Preserve existing
	DECL_ARGUMENTS for a FUNCTION_DECL only if the decl already
	has a DECL_SAVED_TREE.
	(pph_reset_external): Remove.  Update all users.
	(pph_in_nonnull_tree): Overwrite *FIELD only if it is
	currently NULL.
	(pph_in_cgraph_node): Remove.  Update all users.
	(pph_node_already_emitted): Remove.  Update all users.
	(pph_fn_already_expanded): New.
	(pph_in_symtab): Call it.
	Read all new fields in pph_symtab_entry.
	Handle PPH_SYMTAB_EXPAND and PPH_SYMTAB_EXPAND_1 actions.
	* pph-out.c (pph_out_struct_function_for_decl): Remove.
	(pph_out_symtab_action): Assert that the action is in the set
	of known action.
	(pph_out_cgraph_node): Remove.  Update all users.
	(pph_out_cgraph_node_for_decl): Remove.  Update all users.
	(pph_add_decl_to_symtab): Capture global state required to
	re-play symtab actions in the reader.
	(pph_out_symtab): Write all new fields from pph_symtab_entry.
	* pph-streamer.h (struct pph_symtab_entry): Add fields AT_EOF,
	X_PROCESSING_TEMPLATE_DECL and FUNCTION_DEPTH.
	* pph.h (enum pph_symtab_action): Add value PPH_SYMTAB_EXPAND_1.
	(enum pph_tag): Remove value PPH_cgraph_node.  Update all
	users.
	(pph_writer_enabled_p): Move to c-family/c-opts.c.
	(pph_enabled_p): Likewise.
	* cp/semantics.c (expand_or_defer_fn_1): If we are generating
	a PPH file, add it to the symbol table and return.
	(expand_or_defer_fn): Likewise.
	* toplev.c (compile_file): If -fpph-gen is used, do not
	generate code.

2012-03-13   Diego Novillo  <dnovillo@google.com>

	* decl.c (record_builtin_type): Call pph_register_builtin_type.
	* pph-core.c (pph_cache_add_full_tree_r): New.
	(pph_cache_add_full_tree): New.
	(nitc_callback): New.
	(pph_builtin_types): Declare.
	(pph_register_builtin_type): New.
	(pph_cache_add_builtin_types): New.
	(pph_cache_add_canonical_type): New.
	(pph_cache_preload): Call pph_cache_add_full_tree instead of
	pph_cache_add.
	Call traverse_nonstandard_integer_type_cache with nitc_callback.
	Call pph_cache_add_builtin_types.
	Call type_hash_table_traverse.
	* pph-in.c (pph_in_tcc_type): Read TYP_NEXT_PTR_TO for
	POINTER_TYPE types.
	(pph_read_file_1): Call pph_in_canonical_template_parms.
	* pph-out.c (pph_out_tcc_type): Write TYPE_NEXT_PTR_TO for
	POINTER_TYPE types.
	(pph_write_file): Call pph_out_canonical_template_parms.
	* pph.h (pph_register_builtin_type): Declare.
	(pph_out_canonical_template_parms): Declare.
	(pph_in_canonical_template_parms): Declare.
	* pt.c (pph_out_canonical_template_parms): New.
	(pph_in_canonical_template_parms): New.

2012-03-09   Lawrence Crowl  <crowl@google.com>

	* name-lookup.c (pph_out_binding_table): Correct comment.
	(pph_in_binding_table): Correct comment.
	* pph-out.c (pph_out_lang_type_class_bits): New.
	(pph_out_lang_type_class): Factor out the bitpack writing into
	pph_out_lang_type_class_bits.
	(pph_out_merge_key_lang_type_class): New.
	(pph_out_merge_key_lang_type): New.
	(pph_out_merge_key_tree): Also emit merge key for lang_type for classes.
	* pph-in.c (typedef merge_toc_entry): Generalize context.
	(pph_toc_lookup_add): New.
	(pph_merge_into_chain): Factor out TOC lookup and add to
	pph_toc_lookup_add.
	(pph_in_merge_lang_type_class_bits): New.
	(pph_in_lang_type_class): Factor out the bitpack reading into
	pph_in_merge_lang_type_class_bits.
	(pph_in_merge_key_lang_type_class): New.
	(pph_in_merge_key_lang_type): New.
	(pph_in_merge_key_tree_with_searcher): Also merge key for lang_type
	for classes.

2012-03-07   Lawrence Crowl  <crowl@google.com>

	* cp-tree.h (TFF_LOC_FOR_TEMPLATE_PARMS): New.
	* error.c (dump_location_qualifier): New.
	(dump_type): Add source location qualifier to template type parameter
	identifiers.
	* mangle.c (write_template_arg_literal): Revert to prior code.
	* pph-streamer.h (pph_trace_note): New.
	* pph-core.c (pph_trace_note): New.
	* pph-out.c (pph_out_struct_function_for_decl): New.
	(pph_out_cgraph_node_for_decl): New.
	(pph_out_symtab): Update to use functions above.
	(pph_merge_name): Add TFF_LOC_FOR_TEMPLATE_PARMS for pretty name.
	(pph_out_merge_name): Trace merge names.
	(pph_out_merge_key_tree): Emit merge keys for class fields and methods.
	* pph-in.c (pph_in_merge_key_tree_with_searcher): Merge in keys for
	class fields and methods.

2012-03-01   Lawrence Crowl  <crowl@google.com>

	* pph-core.c (pph_include_handler): Make warning message a single line.
	* Make-lang.in (cp/pt.o): Depend on strptrmap.h.
	* pph.h (pph_out_merge_key_tree): Made extern.
	(pph_in_string): Made extern.
	(typedef pph_merge_searcher): New.
	(pph_in_merge_key_tree_with_searcher): Made extern.
	(pph_out_pending_templates_list): Removed.
	(pph_out_spec_entry_tables): Removed.
	(pph_in_pending_templates_list): Removed.
	(pph_in_spec_entry_tables): Removed.
	(pph_out_merge_key_template_state): New.
	(pph_out_merge_body_template_state): New.
	(pph_in_merge_key_template_state): New.
	(pph_in_merge_body_template_state): New.
	* pt.c (#include "strptrmap.h"): New.
	(pph_out_pending_templates_list): Move dump to higher level.
	(pph_in_pending_templates_list): Make static.
	(pph_out_key_spec_entry_slot): New.
	(pph_out_spec_entry_slot): Renamed to pph_out_body_spec_entry_slot.
	(pph_out_spec_entry_htab): Make slot function a parameter.
	(pph_in_search_key_spec): New.
	(pph_in_keys_spec_entry_htab): New.
	(pph_in_spec_entry_htab): Rename to pph_in_bodies_spec_entry_htab.
	(pph_out_merge_key_template_state): New.
	(pph_out_spec_entry_tables): Rename to
	pph_out_merge_body_template_state.  Pass search functions.  Add call
	to pph_out_pending_templates_list.  Move dumping here.
	(static strptrmap_t *decl_spec_tbl): New.
	(static strptrmap_t *type_spec_tbl): New.
	(pph_in_merge_key_template_state): New.
	(pph_in_spec_entry_tables): Rename to pph_in_merge_body_template_state.
	Add call to pph_in_pending_templates_list.  Move dumping here.
	* pph-out.c (pph_out_merge_key_tree): Made extern.  Added bool
	parameter to force merge name emission, which is used for template
	type specialization merging.
	(pph_out_global_binding): Split into pph_out_global_binding_keys and
	pph_out_global_binding_bodies.
	(pph_write_file): Change calls for emitting global bindings and
	template state.
	* pph-in.c (pph_in_string): Make extern.
	(pph_in_merge_key_tree): Factor out searching into function parameter.
	Rename to pph_in_merge_key_tree_with_searcher.  Always merge trees
	when a match is found.  Make extern.
	(pph_in_search_key_decl_on_chain): New.
	(pph_in_merge_key_decl_on_chain): New.
	(pph_in_search_key_type_in_field): New.
	(pph_in_merge_key_type_in_field): New.
	(pph_in_global_binding): Split into pph_in_global_binding_keys and
	pph_in_global_binding_bodies.
	(pph_read_file_1): Change calls for emitting global bindings and
        template state.

2012-02-23   Lawrence Crowl  <crowl@google.com>

	* pph-core.c (pph_trace_tree): Trace trees as well as decls.
	* cp-tree.h (class_of_this_parm): Protect against null type.
	* error.c (dump_function_decl): Protect against null type.
	* pph-out.c (pph_out_tree): Write tree header for mutated trees.
	* pph-in.c (pph_merge_tree_attributes): New.
	(pph_in_merge_key_tree): Merge tree attributes.
	(pph_in_tree): Read tree header for mutated trees.
	Merge their attributes.

2012-02-20   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_init): Use stderr for -fpph-tracer.

2012-02-16   Lawrence Crowl  <crowl@google.com>

	* pph-in.c (pph_in_merge_lang_indep_tree_body): Avoid a false "used
	uninitialized" error message.

2012-02-15   Lawrence Crowl  <crowl@google.com>

	* pph-in.c (pph_in_merge_ld_base): Merge odr_used.
	(pph_in_lang_indep_tree_body): New, replacing idiom.
	(pph_in_merge_lang_indep_tree_body): Decl merge corresponding to above.
	(pph_reset_external): New, from refactoring.
        (pph_in_tcc_declaration_tail): Moved into pph_in_tcc_declaration.
	(pph_in_tcc_declaration): As above.  Factor out pph_reset_external.
	(pph_in_nonnull_tree): New.
	(pph_in_merge_tcc_declaration): Do serious decl merging.
	(pph_in_identifier_bindings): Factor out pph_in_lang_indep_tree_body.
	(pph_in_merge_tree_body): Factor out pph_in_lang_indep_tree_body.
	Move pph_in_lang_indep_tree_body and TREE_CHAIN save/restore into
	pph_in_merge_tcc_declaration.  Do some spacing corrections.

2012-02-13   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_binding_level_start): Move earlier into the
	file.
	Change return type to cp_binding_level *.
	Add argument EXISTING_BL and EXISTED_P.
	If EXISTING_BL is given, and a reference is read from STREAM,
	the reference read should be the same as EXISTING_BL.
	If EXISTING_BL is given and a new reference is started,
	do not allocate a new instance.  Rather, register EXISTING_BL
	in the cache.
	(pph_in_binding_level_ref): Rename from pph_in_binding_level.
	Assert that it always reads a reference record.
	Update all users.
	(pph_in_binding_level_1): Move body inside
	pph_in_merge_body_binding_level.
	(pph_in_merge_key_binding_level): Move earlier in the file.
	(pph_in_merge_body_binding_level): Move earlier in the file.
	(pph_in_merge_body_binding_level_1): Move body into
	pph_in_merge_body_binding_level.
	(pph_in_ld_ns): Call pph_in_binding_level_ref.
	(pph_ensure_namespace_binding_level): Move body into
	pph_in_merge_key_namespace_decl.  Update all users.
	(pph_in_merge_key_namespace_decl): Fix comment.
	(pph_in_global_binding): Call pph_in_binding_level_start.
	* pph-out.c (pph_out_tree_vec_unchain): Remove.
	(pph_out_chain_filtered): Remove.
	(pph_out_binding_level_ref): Rename from
	pph_out_binding_level.  Always expect to write a reference
	record.  Update all users.
	(pph_out_cxx_binding_1): Embed inside pph_out_merge_body_binding_level.
	Update all users.
	(pph_out_merge_key_binding_level): Do not filter
	BL->NAMESPACES.
	(pph_out_merge_body_binding_level): Likewise.

2012-02-01   Diego Novillo  <dnovillo@google.com>

	* error.c (dump_function_decl): Add missing ';'.

2012-02-01   Diego Novillo  <dnovillo@google.com>

	* config-lang.in (gtfiles): Remove pph-out.c.  Add pph-core.c.
	* pph-core.c: Include gt-cp-pph-core.h.
	(pph_cached_trees): Declare.
	(pph_cache_insert_at): If adding a tree to the cache, also
	add it to pph_cached_trees.
	(pph_streamer_init): Set pph_cached_trees to NULL.
	(pph_streamer_finish): Likewise.
	Call ggc_collect.
	* pph-out.c (pph_decls_in_symtab): Remove.  Update all users.

2012-02-01   Lawrence Crowl  <crowl@google.com>

	* error.c (dump_function_decl):  Add protection against NULL.
	* pph-out.c (pph_out_merge_key_tree):  Write merge keys for struct
	types, as opposed to decls.
	* pph-in.c (pph_in_merge_tree_body):  Save chains in decls only.
	(pph_in_merge_key_tree): Read merge keys for struct types.  Split
	handling into two phases, cache insertion (which is before the trace
	front) and sub-tree reading.

2012-02-01   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_trace_tree):  Add name parameter.  Adjust callers
	to match.
	* pph-core.c (pph_trace_tree):  Add name parameter to override
	pretty-printing the tree.
	* error.c (dump_type): Protect against null TYPE_NAME.
	(dump_aggr_type): Factor out test for template.
	(is_template): New.  Protect against null DECL_TEMPLATE_PARMS.
	* pph-out.c (pph_out_merge_body_namespace_decl): Factor out assert for
	mergable trees into separate cases.  Merging of types is currently
	unexpected and disabled.
	* pph-in.c (pph_in_merge_key_namespace_decl): Remove redundant assert
	for mergable trees.
	(pph_in_merge_key_namespace_decl): Factor out assert for mergable trees
	into separate cases.  Merging of types is currently unexpected and
	disabled.

2012-01-31   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_out_binding_table): Use
	PPH_RECORD_START_NO_CACHE records.
	(pph_in_binding_table): Likewise.
	* pph-in.c (pph_in_language_function): Remove caching code,
	assume that the structure is always in a
	PPH_RECORD_START_NO_CACHE.
	(pph_in_struct_function): Likewise.
	(pph_in_lang_decl): Likewise.
	(pph_in_sorted_fields_type): Likewise.
	(pph_in_lang_type_class): Likewise.
	(pph_in_lang_type): Likewise.
	(pph_in_lang_decl_start): Remove.
	* pph-out.c (pph_get_marker_for): Always return
	PPH_RECORD_START_NO_CACHE for PPH_binding_table, PPH_function,
	PPH_lang_decl, PPH_lang_type, PPH_language_function and
	PPH_sorted_fields_type.
	(pph_out_start_record): Do not write IX for
	PPH_RECORD_START_NO_CACHE.
	(pph_out_language_function): Only support
	PPH_RECORD_START_NO_CACHE or PPH_RECORD_END.
	(pph_out_struct_function): Likewise.
	(pph_out_lang_decl): Likewise.
	(pph_out_sorted_fields_type): Likewise.
	(pph_out_lang_type_class): Likewise.
	(pph_out_lang_type): Likewise.

2012-01-27   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): If PPH has been disabled,
	process the file as a regular text include.
	* pph-out.c (pph_disable_output): Also disable the reader.

2012-01-27   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_stream_open): If STREAM exists and its mode
	is different than the mode in which it was originally opened,
	return NULL.

2012-01-26   Lawrence Crowl  <crowl@google.com>

	* decl2.c (#include "pph.h"): New.
	(pph_out_decl2_hidden_state): New.
	(pph_in_decl2_hidden_state): New.
	(pph_dump_decl2_hidden_state): New.
	* Make-lang.in (cp/decl.o): Add dependence on $(CXX_PPH_H)
	* pph.h (pph_dump_vec_tree): Externalize.
	(pph_out_tree_vec): Externalize.
	(pph_in_tree_vec): Externalize.
	(pph_union_into_tree_vec): Externalize.
	(pph_out_decl2_hidden_state): New.
	(pph_in_decl2_hidden_state): New.
	(pph_dump_decl2_hidden_state): New.
	* pph-core.c (pph_dump_vec_tree): Externalize.
	(pph_dump_global_state): Call pph_dump_decl2_hidden_state.
	* pph-out.c (pph_out_tree_vec): Externalize.
	(pph_write_file): Call pph_out_decl2_hidden_state.
	* pph-in.c (pph_in_tree_vec): Externalize.
	(pph_union_into_tree_vec): Externalize.
	(pph_read_file_1): Call pph_in_decl2_hidden_state.

2012-01-26   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_loaded): Tidy.

2012-01-26   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): Tidy warning message.
	* pph-out.c (pph_disable_output): Add tracing output.

2012-01-26   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_stream_close_1): Add a newline to fprintf call.
	(pph_finish): If there were errors during compilation,
	disable PPH generation.
	* pph-out.c (pph_disable_output): Also set pph_out_stream to
	NULL.

2012-01-26   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_read_file): Remove leftover debugging code.

2012-01-26   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): Call pph_writer_get_stream.
	(pph_add_include): Move to pph-in.c
	(pph_stream_open): Initialize STREAM->INCLUDES.M.
	(pph_stream_close_1): Free STREAM->INCLUDES.M.
	* pph-in.c (pph_in_symtab): For functions we are going to
	expand, set DECL_EXTERNAL to false.
	(pph_add_include_1): New.
	(pph_add_include): Move from pph-core.c.  Call pph_add_include_1.
	(pph_read_file): Add argument PARENT.  Update all callers.
	If PARENT is given, add STREAM to PARENT's #include table.
	* pph-out.c (pph_writer_get_stream): New.
	* pph-streamer.h (struct pph_stream): Change field INCLUDES to
	be a structure with two fields V and M.  Update all users.
	(pph_add_include): Remove.
	(pph_writer_add_include): Remove.
	(pph_read_file): Add second argument.

2012-01-25   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_dump_includes): New.
	* pph.h (pph_dump_includes): Declare.

2012-01-25   Lawrence Crowl  <crowl@google.com>

	* pph-core.c (pph_dump_tree_name): Refactor.
	(pph_dump_overload_names): New.
	(pph_dump_one_binding): New.
	(pph_dump_bindings_for_id): New.
	(pph_dump_bindings_for_decl): New.
	(pph_dump_chain): Dump builtins at -fpph-debug>=5.  Remove unneeded
	'next' variable.
	(pph_dump_binding): Likewise.
	(pph_loaded): Clarify purpose of global state dump.
	* name-lookup.c (pph_debug_binding_inaction): Remove redundant output.
	(pph_set_identifier_bindings): Removed.
	(pph_set_chain_identifier_bindings): Removed.
	(pph_set_namespace_bindings): Removed.
	(pph_set_identifier_binding): New.  Refactored from
	pph_set_namespace_bindings.  Fixes some identifer binding issues.
	(pph_set_namespace_decl_binding): New. Refactored from
	pph_set_namespace_bindings.
	(pph_set_chain_namespace_bindings): Use pph_set_namespace_decl_binding
	instead of pph_set_namespace_bindings.
	(pph_set_global_identifier_bindings): Remove bad calls to
	pph_set_chain_identifier_bindings.

2012-01-25   Diego Novillo  <dnovillo@google.com>

	* pph-core.c: Fix copyright and contribution data.
	* pph-in.c: Likewise.
	* pph-out.c: Likewise.
	* pph-streamer.h: Likewise.
	* pph.h: Likewise.

2012-01-24   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_dump_global_state): New.
	(pph_dump_namespace): Removed; callers now use pph_dump_global_state.
	* pph-core.c (pph_dump_tree_name): Add tree pointer.
	(pph_dump_vec_tree): New.
	(pph_dump_namespace): Remove message parameter.
	(pph_dump_global_state): New.
	(pph_loaded): Call pph_dump_global_state instead of pph_dump_namespace.
	* pph-out.c (pph_write_file): Call pph_dump_global_state instead of
	pph_dump_namespace.
	* error.c (dump_decl): Protect against null pointers.
	* name-lookup.c (pph_debug_binding_action): Add PPH: output label.
	(pph_debug_binding_inaction): Add PPH: output label.
	(pph_set_identifier_bindings): Modify debug label.
	(pph_debug_overload_binding_action): New.
	(pph_set_namespace_bindings): Call pph_debug_overload_binding_action
	instead of pph_debug_binding_action.
	(pph_add_overload): Remove unused.
	* pph-in.c (pph_is_on_chain): New.
	(pph_union_into_chain): New.
	(pph_read_file_1): Call pph_union_into_chain for keyed_classes.
	Call pph_union_into_tree_vec for unemitted_tinfo_decls.
	Call pph_dump_global_state instead of pph_dump_namespace.

2012-01-24   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_tree_header): Add argument FULLY_READ_P.
	Remove argument TAG.  Update all callers.
	Move LTO tag reading code from ...
	(pph_in_tree): ... here.
	(pph_in_merge_body_namespace_decl): Remove unused code.
	* pph-out.c (pph_out_tree): Remove check for IDENTIFIER_NODE.

2012-01-20   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_machine_mode): New.
	(pph_in_tcc_type): Call it.
	* pph-out.c (pph_out_machine_mode): New.
	(pph_out_tcc_type): Call it.

2012-01-20   Diego Novillo  <dnovillo@google.com>

	* config-lang.in (gtfiles): Remove pph.h and pph-core.c.
	Add pph-out.c
	* pph-out.c: Include gt-cp-pph-out.h.
	(pph_decls_in_symtab): Declare.
	(pph_writer_init): Initialize.
	(pph_add_decl_to_symtab): Add DECL to pph_decls_in_symtab.
	(pph_writer_finish): Set pph_decls_in_symtab and call
	ggc_collect.

2012-01-20   Lawrence Crowl  <crowl@google.com>

	* parser.c (cp_debug_parser_where): Protect against null pointers.
	* name-lookup.c (cxx_binding_make_for_name): New.
	(binding_for_name): Factor construction into the above.
	(modify_binding_for_overload): New.
	(push_overloaded_decl_1): Factor out above function.
	(pph_foreach_on_chain_bl): Add filter parameter.
	(pph_set_identifier_bindings): Likewise.
	(pph_set_chain_identifier_bindings): Likewise.
	(pph_set_chain_namespace_bindings): Likewise.
	(pph_set_namespace_bindings): Likewise.  Correct overloading.
	(pph_set_namespace_namespace_bindings): Add filter parameter in calls.
	(pph_set_global_identifier_bindings): Likewise.

2012-01-19   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_tree): Sign EXPR from the cache it was
	taken from.
	* pph-streamer.h (pph_cache_select): Handle PPH_RECORD_START,
	PPH_RECORD_START_MERGE_BODY, PPH_RECORD_START_MERGE_KEY
	and PPH_RECORD_START_MUTATED.

2012-01-18   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): If the primary file
	uses #include_next, emit a warning and call
	pph_disable_output.
	(pph_stream_close_1): Factor out of ...
	(pph_stream_close): ... here.
	(pph_stream_close_no_flush): New.
	(pph_streamer_finish): Call pph_writer_finish if
	pph_writer_enabled_p returns true.
	Call pph_reader_finish if pph_reader_enabled_p returns
	true.
	* pph-in.c (pph_in_include): Assert that we are not
	trying to read STREAM from STREAM.
	* pph-out.c (pph_out_line_table_and_includes): Do not
	emit a line table reference to STREAM.
	(pph_disable_output): New.
	* pph-streamer.h (pph_stream_close_no_flush): Declare.
	(pph_disable_output): Declare.

2012-01-17   Lawrence Crowl  <crowl@google.com>

	* pph.h (pph_files_read): New.
	(chain2vec): Move from static to global.
	* pph-streamer.h (pph_dump_namespace): Add message parameter.
	* pph-core.c (pph_dump_namespace): Add message parameter.
	(pph_trace_marker): Add PPH: label to debugging output.
	(pph_cache_insert_at): Remove non-static aggregate initializer.
	(pph_loaded): Enable pph_set_global_identifier_bindings().
	* pph-out.c (chain2vec): Move from static to global.
	(pph_out_merge_key_namespace_decl): New.
	(pph_out_merge_body_namespace_decl): New.
	(pph_foreach_out_chain): New.
	(pph_out_merge_key_binding_level): Handle namespace keys separately.
	(pph_out_merge_key_tree): Likewise.
	(pph_out_merge_body_binding_level): Handle namespace bodies separately.
	(pph_out_identifier_bindings): No longer emit most binding info.
	(pph_out_merge_key_namespace_decl): Output record info.
	(pph_out_merge_body_namespace_decl): New.
	* pph-in.c (pph_in_merge_body_namespace_decl): New.
	(pph_in_merge_key_namespace_decl): New.
	(pph_in_merge_key_binding_level): Handle namespace separately.
	(pph_in_merge_key_tree): Likewise.
	(pph_in_merge_body_binding_level_1): Likewise.
	(pph_in_identifier_bindings): No longer emit most binding info.
	(pph_ensure_namespace_binding_level): New.
	(pph_in_merge_key_namespace_decl): Modify chain as needed.
	(pph_in_merge_body_namespace_decl): New.
	(bool pph_files_were_read): New.
	(pph_files_read): New.
	(pph_read_file_1): Set pph_files_were_read.
	* pt.c (pph_dump_tinst_level): Add PPH: label to debugging output.
	(pph_dump_pending_templates_list): Likewise.
	(pph_dump_spec_entry_slot): Likewise.
	(pph_dump_spec_entry_htab): Likewise.
	* parser.h (cp_debug_parser_where): New.
	* parser.c (cp_debug_parser_where): New.
	(c_parse_file): Conditionalize call to pph_loaded.
	* name-lookup.c (pph_debug_binding_action): New.
	(pph_debug_binding_inaction): New.
	(pph_foreach_on_chain_bl): New.
	(pph_set_identifier_bindings): New.
	(pph_set_chain_identifier_bindings): Use pph_set_identifier_bindings.
	(pph_set_namespace_bindings): New.
	(pph_set_chain_namespace_bindings): New.
	(pph_foreach_on_chain): New.
	(pph_set_namespace_namespace_binding): New.
	(pph_set_namespace_namespace_bindings): New.
	(pph_set_global_identifier_bindings): Add call to
	pph_set_namespace_namespace_bindings.

2012-01-17   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_stream_register): Move in-memory marking...
	* pph-in.c (pph_read_file_1): ... here.

2012-01-17   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_read_file_1): Move in-memory marking for STREAM...
	* pph-core.c (pph_stream_register): ... here.

2012-01-16   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_set_global_identifier_bindings): Make
	parameter list void.
	* pph.h (pph_set_global_identifier_bindings): Likewise.
	* pph-core.c (pph_stream_registry_add_name): Fix use of struct
	pph_name_stream_map.

2012-01-16   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_stream_register): Move later in the file.
	(pph_stream_unregister): Likewise.
	(pph_stream_registry_ix_for): Fix comparison to !=.
	(pph_stream_registry_add_name): Make extern.
	Allocate a new slot in the table.
	(pph_stream_set_header_name): New.
	(pph_stream_registry_lookup): Fix computation of SLOT_IX.
	(pph_stream_open): Call pph_stream_register earlier.
	* pph-in.c (pph_in_line_table_and_includes): Call
	pph_stream_set_header_name.
	* pph-out.c (pph_init_write): Likewise.
	(pph_get_next_include): Remove.  Update all users.
	(pph_out_line_table_and_includes): Call
	pph_stream_registry_lookup to determine if the file being
	entered is a PPH image.
	* pph-streamer.h (pph_stream_registry_lookup): Declare.
	(pph_stream_set_header_name): Declare.

2012-01-16   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (struct pph_name_stream_map): Declare.
	(struct pph_stream_registry_d): Declare.
	(pph_stream_registry): New.
	(pph_read_images): Remove.  Update all users.
	(pph_find_stream_for): Remove.  Update all users.
	(pph_mark_stream_read): Remove.  Update all users.
	(pph_stream_register): New.
	(pph_stream_unregister): New
	(pph_stream_registry_ix_for): New.
	(pph_stream_registered_p): New.
	(pph_stream_registry_add_name): New.
	(pph_stream_registry_lookup): New.
	(pph_stream_open): Call it.
	Call pph_stream_register.
	(pph_stream_close): Call pph_stream_unregister.
	(pph_header_image_hash): New.
	(pph_header_image_eq): New.
	(pph_init): Initialize pph_stream_registry.
	(pph_streamer_finish): Free memory used by pph_stream_registry.
	* pph-in.c (pph_read_file_1): Do not call pph_mark_stream_read.
	Set STREAM->IN_MEMORY_P to true.
	* pph-streamer.h (pph_mark_stream_read): Remove.

2012-01-13   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_line_table_and_includes): Fix computation of
	includer file index relocation.
	* pph-out.c (pph_out_line_map_ordinary): Add documentation.

2011-12-12   Diego Novillo  <dnovillo@google.com>

	* pph-out.c (pph_out_global_binding): Do not assert that
	scope_chain->x_stmt_tree.x_stmts_are_full_exprs_p is
	false.

2011-12-09   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_include_handler): Use LOC instead of
	INPUT_LOCATION.

2011-12-09   Diego Novillo  <dnovillo@google.com>

	* pph-core.c (pph_is_valid_here): Call warning_at instead of
	error_at.
	(pph_include_handler): If pph_read_file returns NULL, emit
	warning and proceed with textual header parsing.
	* pph-in.c (pph_read_file): Do not call fatal_error if
	FILENAME is not found.

2011-12-08   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (struct pph_stream): Add field HEADER_NAME.
	* pph-in.c (pph_in_line_table_and_includes): Read it.
	* pph-out.c (pph_init_write): Initialize it from input_filename.
	(pph_filename_eq_ignoring_path): Remove.
	(pph_out_line_table_and_includes): Write STREAM->HEADER_NAME.
	Compare the file name in LM against STREAM->HEADER_NAME to
	decide whether to write a reference to an external PPH.

2011-12-05   Diego Novillo  <dnovillo@google.com>

	* cp/pph-in.c (pph_in_merge_key_binding_level): Support NULL values
	of BL.
	(pph_in_merge_key_namespace_decl): If DECL does not have
	DECL_LANG_SPECIFIC set, use a NULL binding level.
	(pph_in_merge_key_tree): Support NULL values of CHAIN.

2011-12-05   Diego Novillo  <dnovillo@google.com>

	* pph-out.c (pph_out_tcc_declaration): Write DECL_ABSTRACT_ORIGIN.
	* pph-in.c (pph_in_tcc_declaration_tail): Read DECL_ABSTRACT_ORIGIN.
	(pph_in_merge_key_namespace_decl): Remove argument DECL.
	Update all users.
	Create an empty binding level to read all merge keys into.

2011-12-02   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_lang_decl_start): Rename from pph_in_ref_lang_decl.
	Handle PPH_RECORD_START_MERGE_BODY records.
	Add argument IS_MERGE_P.  Set it to true if the caller should do
	a merge read.
	Update all users.
	(pph_in_lang_decl): Call pph_in_merge_ld_base when reading
	a merge record.
	(pph_in_merge_lang_decl): Remove.  Update all users.

2011-12-02   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_cxx_binding_1): Assert that we are not
	reading a merge record.
	(pph_in_class_binding): Likewise.
	(pph_in_label_binding): Likewise.
	(pph_in_language_function): Likewise.
	(pph_in_struct_function): Likewise.
	(pph_in_sorted_fields_type): Likewise.
	(pph_in_lang_type_class): Likewise.
	(pph_in_lang_type): Likewise.
	(pph_in_merge_key_binding_level): Rename from pph_in_binding_merge_keys.
	(pph_in_merge_body_binding_level_1): Rename from
	pph_in_binding_merge_bodies_1.  Update all users.
	(pph_in_merge_body_binding_level): Rename from
	pph_in_binding_merge_bodies.  Update all users.
	(pph_in_ref_lang_decl): Rename from pph_in_ref_lang_specific.
	Update all users.
	Assert that we are not reading a merge record.
	(pph_in_lang_decl): Rename from pph_in_lang_specific.  Update all users.
	(pph_in_merge_lang_decl): Rename from pph_in_merge_lang_specific.
	* pph-out.c (pph_out_reference_record): Support
	PPH_RECORD_START_MERGE_BODY records.
	Return the written marker instead of a boolean value.
	Update all users.
	(pph_out_start_merge_key_record): Accept a void * instead of
	tree.  Add pph_tag argument.  Update all users.
	(pph_out_start_merge_key_tree_record): New.
	(pph_out_merge_key_binding_level): Rename from
	pph_out_binding_merge_keys.
	(pph_out_merge_body_binding_level): Rneame from
	pph_out_binding_merge_bodies.
	(pph_out_cxx_binding_1): Assert that we are not writing a
	merge record.
	(pph_out_cxx_binding): Likewise.
	(pph_out_class_binding): Likewise.
	(pph_out_label_binding): Likewise.
	(pph_out_language_function): Likewise.
	(pph_out_struct_function): Likewise.
	(pph_out_ld_parm): Likewise.
	(pph_out_lang_decl): Likewise.
	(pph_out_sorted_fields_type): Likewise.
	(pph_out_lang_type_class): Likewise.
	(pph_out_lang_type): Likewise.
	(pph_out_cgraph_node): Likewise.
	(pph_out_tree): Call pph_is_reference_or_end_marker.
	* pph-streamer.h (pph_is_reference_or_end_marker): New.

2011-12-02   Diego Novillo  <dnovillo@google.com>

	* pph-in.c (pph_in_bool): New.
	(pph_in_merge_key_namespace_decl): Factor out of ...
	(pph_in_merge_key_tree): ... here.
	Handle namespace aliases. 
	* pph-out.c (pph_out_bool): New.
	(pph_out_merge_key_namespace_decl): Factor out of ...
	(pph_out_merge_key_tree): ... here.
	Handle namespace aliases.

2011-12-01   Diego Novillo  <dnovillo@google.com>

	* pph-out.c (pph_out_global_binding): Fix empty test
	for scope_chain->x_stmt_tree.x_cur_stmt_list.

2011-11-30   Lawrence Crowl  <crowl@google.com>

	* pph.h (pph_loaded): New.
	(pph_set_global_identifier_bindings): New.
	(pph_out_binding_table): Add extern.
	(pph_in_binding_table): Add extern.
	* pph-core.c (pph_loaded): New.
	* parser.c (c_parse_file): Call pph_loaded.
	* name-lookup.c (pph_set_chain_identifier_bindings): New.
	(pph_set_global_identifier_bindings): New.
	* pph-out.c (pph_out_identifier_bindings): New.
	(pph_out_tree_body): Call above function.
	(pph_out_tree): Call above functions for builtins.
	* pph-in.c (pph_in_merge_ld_base): New.
	(pph_in_ref_lang_specific): Factored from pph_in_lang_specific.
	(pph_in_lang_specific): Call pph_in_ref_lang_specific.
	(pph_in_merge_lang_specific): New.
	(pph_in_tcc_declaration_tail): Factored from pph_in_tcc_declaration.
	(pph_in_tcc_declaration): Call pph_in_tcc_declaration_tail.
	(pph_in_merge_tcc_declaration): New.
	(pph_in_identifier_bindings): New.
	(pph_in_tree_body): Call above function.
	(pph_in_merge_tree_body): New.
	(pph_in_tree): Call pph_in_identifier_bindings functions for builtins.
	Call pph_in_merge_tree_body for merge bodies.

2011-11-29   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.c: Renamed pph-core.c.
	* pph.c: Contents moved into pph-core.c.
	(pph_dump_min_decl): Removed unused.
	(flatten_name): Rename pph_flatten_name.
	* pph-streamer-in.c: Renamed pph-in.c.
	* pph-streamer-out.c: Renamed pph-out.c.
	* pph-streamer.h: Adjust to reflect above.  Remove unneeded decls.
	* pph.h: Adjust to reflect above.
	* config-lang.in: Adjust to reflect above.
	* Make-lang.in: Adjust to reflect above.
	(CXX_PPH_STREAMER_H): Remove redundancies.
	(CXX_PPH_COMMON_H): New.
	(CXX_PPH_COMMON_H): New.
	(cp/pph-core.o): Remove redundancies.
	(cp/pph-in.o): Remove redundancies.
	(cp/pph-out.o): Remove redundancies.
	(cp/pt.o): Add depndence on CXX_PPH_H.
	* pt.c: Remove redundant #include "pph-streamer.h".

2011-11-13   Diego Novillo  <dnovillo@google.com>

	* parser.c (c_parse_file): Call pph_init_include_tree.
	* pph.c (pph_init_include_tree): New.
	(flatten_name): New.
	(pph_file_change_handler): New.
	(pph_include_handler_for_map): New.
	(pph_init_map_file): New.
	(pph_finish_map_file): New.
	* pph.h (pph_init_include_tree): New.

2011-11-07   Lawrence Crowl  <crowl@google.com>

	* pph.c (pph_tree_code_text): Fix formatting.
	* pph-streamer.h (enum pph_trace_end): New.
	(pph_trace_tree): Add 'which end' parameter.
	(pph_trace_marker): New.
	* gcc/cp/pph-streamer.c (marker_strings[]): New.
	(tag_strings[]): New.
	(pph_trace_marker): New.
	(pph_trace_tree): Add tree prefix tracing.
	* pph-streamer-out.c: Add section separators.
	(pph_out_stream): Move to stream initialization section.
	(pph_out_record_marker): Add record tracing.
	(chain2vec_filter): Disable assert on 'none' filter.
	(pph_out_chain_filtered): Likewise.
	(pph_out_binding_merge_bodies): Add more merge fodder.
	(pph_out_merge_key_tree): Add tree prefix tracing.
	(pph_out_tree): Likewise.
	* pph-streamer-in.c: Add section separators.
	(ALLOC_AND_REGISTER): Move to record handling section.
	(pph_loc_offset): Move to source information section.
	(pph_in_record_marker): Add record tracing.
	(pph_in_binding_level): Factor into pph_in_binding_level and
	pph_in_binding_level_start.
	(pph_in_binding_merge_bodies): Factor actual merging into separate
	pph_in_binding_merge_bodies_1.
	(pph_in_ld_ns): Merge into a binding if one already exists.
	(pph_in_tree_body): Add debugging code.
	(pph_in_merge_key_tree): Add tree prefix tracing.
	Do not allocate a namespace binding if one exists already.
	(pph_in_tree): Add prefix tracing.
	(pph_in_global_binding): Call pph_in_binding_merge_bodies_1 to avoid
	allocation.
	

2011-11-01   Lawrence Crowl  <crowl@google.com>

	* pph-streamer-out.c (pph_out_binding_level_1): Remove streaming of
	static_decls.
	(pph_out_binding_level): Add streaming of static_decls.
	(pph_out_binding_merge_bodies): Likewise.
	* pph-streamer-in.c (pph_is_tree_element_of_vec): New.
	(pph_union_two_tree_vecs): New.
	(pph_union_into_tree_vec): New.
	(pph_in_binding_level_1): Remove streaming of static_decls.
	(pph_in_binding_level): Add streaming of static_decls.
	(pph_in_binding_merge_bodies): Add merging of static_decls from
	streamer into existing binding.  Needs new function parameter.
	(pph_in_merge_key_tree): Preallocate namespace cp_binding_level.
	(pph_in_global_binding): Update call to pph_in_binding_merge_bodies.

2011-10-29   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_node_already_emitted): New.
	(pph_in_symtab): Call it.

2011-10-28   Lawrence Crowl  <crowl@google.com>

	* pph.c (pph_dump_tree_name): Remove dead code.  Dump tree_code also.
	* pph-streamer.h (enum pph_trace_kind): New.
	(pph_trace_tree): Change bool parameters to a single enum parameter.
	Update callers to match.
	(pph_tree_is_mergeable): All decls and types are mergeable.
	* pph-streamer.c (pph_trace_tree): Avoid printing names for unmerge
	keys, as they are too sparse to print.  Change bool parameters to a
	single enum parameter.  Update body to match.
	* pph-streamer-out.c (pph_out_start_merge_key_record): Handle reference
	merge keys.  Return status.
	(pph_out_merge_body_vec): New.
	(pph_out_merge_body_chain): New.
	(pph_out_merge_keys): Replace with general binding routines below.
	(pph_out_binding_merge_keys): New.
	(pph_out_binding_merge_bodies): New.
	(pph_out_global_binding): Use the above.
	(pph_merge_name): Handle types as well as decls.  Handle unnamed decls.
	Handle namespaces.  Add disabled handling of types.
	(pph_out_tree): Move tracing to postorder traversal to match tracing of
	input streaming.
	* pph-streamer-in.c (htab_merge_key_hash): Hash in tree code.
	(pph_merge_into_chain): Do not merge into null chains.
	(pph_in_binding_level): Split ALLOC_AND_REGISTER into constituents
	for future registration of previously allocated binding level.
	(pph_in_merge_keys): Replace with general binding routines below.
	(pph_in_binding_merge_keys): New.
	(pph_in_binding_merge_bodies): New.
	(pph_in_global_binding): Use the above.
	(pph_in_lang_specific): Avoid reallocating DECL_LANG_SPECIFIC.
	(pph_in_merge_key_tree): Reformat comment.  Handle null and reference
	markers, which may be needed for types.  Add handling of namespaces.
	Add disabled handling of classes and types.
	

2011-10-26   Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (get_mangled_id): Declare.
	* mangle.c (get_mangled_id): Factor out of ...
	(mangle_decl): ... here.
	* pph-streamer-in.c
	(pph_get_include_path_hash): Remove.  Update all users.
	* pph-streamer-out.c (pph_merge_name): Move from pph-streamer.c.
	Change return type to char *.
	Call get_mangled_id and decl_as_string.
	Update users.

2011-10-22   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_merge_key_chain): Add new argument
	IPATH_HASH.  Update all users.
	(pph_match_to_overload): Remove.
	(pph_match_to_function): Remove.
	(pph_match_to_link): Remove.
	(pph_search_in_chain): Remove.
	(merge_toc): Declare.
	(merge_toc_entry): Declare.
	(htab_merge_key_hash): New.
	(htab_merge_key_eq): New.
	(pph_toc_lookup): New.
	(pph_toc_add): New.
	(pph_prepend_to_chain): Add argument IPATH_HASH.  Update all users.
	Call pph_toc_lookup and pph_toc_add.
	(pph_in_merge_key_tree): Add argument IPATH_HASH.  Update all users.
	Call pph_in_string.
	(pph_get_include_path_hash): New.
	(pph_in_merge_keys): Call it.
	(pph_reader_init): New.
	(pph_reader_finish): New.
	* pph-streamer-out.c (pph_out_merge_key_tree): Do not call
	pph_out_location.
	* pph-streamer.c (pph_streamer_finish): Call pph_reader_finish.
	(pph_add_include): Update INCLUDE->PARENT.
	* pph-streamer.h (struct pph_stream): Add field PARENT.
	(pph_reader_init): Declare.
	(pph_reader_finish): Declare.
	* pph.c (pph_init): Call pph_reader_init.

2011-10-20   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (ALLOC_AND_REGISTER_ALTERNATE): Remove.
	(pph_in_tree_1): Remove.
	(pph_in_tree): Rename from pph_in_tree_1.
	(pph_in_chain): Call streamer_read_chain.
	(pph_in_merge_key_chain): New.
	(pph_in_merge_body_chain): Rename from pph_in_mergeable_chain.
	(pph_in_binding_level_1): Switch the order of the arguments.
	Update all users.
	Read fields this_entity and static_decls.
	(pph_in_mergeable_binding_level): Remove.
	(pph_in_merge_key_tree): New.
	(pph_in_tree): Handle PPH_RECORD_START_MERGE_BODY.
	(pph_in_merge_keys): New.
	(pph_in_global_binding): New.
	(pph_read_file_1): Call it.
	* pph-streamer-out.c (pph_get_marker_for):
	(pph_out_start_tree_record): Handle PPH_RECORD_START_MERGE_BODY.
	(pph_out_start_merge_key_record): New.
	(pph_out_tree_1): Remove.
	(pph_out_tree): Rename from pph_out_tree_1.
	Handle PPH_RECORD_START_MERGE_BODY.
	(pph_out_merge_key_vec): Rename from pph_out_mergeable_tree_vec.
	Call pph_out_merge_key_tree.
	(pph_out_merge_key_chain): Rename from pph_out_mergeable_chain_filtered.
	(pph_out_binding_level_1): Handle fields this_entity and static_decls.
	(pph_out_mergeable_binding_level): Remove.
	(pph_out_merge_key_tree): New.
	(pph_out_merge_keys): New.
	(pph_out_global_binding): Call pph_out_merge_keys.
	* pph-streamer.c (pph_cache_insert_at): Return the inserted entry.
	Update all users.
	(pph_cache_add): Likewise.
	(pph_cache_lookup): Return the found entry.  Update all users.
	(pph_cache_lookup_in_includes): Likewise.
	(pph_merge_name): Ignore EXPRs with no lang-specific info.
	* pph-streamer.h (pph_cache_entry): Add field needs_merge_body.
	Update all users.
	(pph_tag_to_tree_code): Remove.
	(pph_tree_is_mergeable): New.
	* pph.h (enum pph_record_marker): Add values PPH_RECORD_START_MERGE_KEY
	and PPH_RECORD_START_MERGE_BODY.

2011-10-16   Lawrence Crowl  <crowl@google.com>

	* pph-streamer-in.c (pph_match_to_overload): Comment on overloading.
	(pph_match_to_function): Allow functions to match for merging.  
	Comment on overloading.
	(pph_match_to_link): Comment on overloading.
	(pph_in_struct_function): Implement overwriting a struct function
	when merging.
	(pph_in_symtab): Add filtering for already emitted functions.
	* pph-streamer.h (pph_trace_tree): Add a boolean parameter specifying
	whether or not the tree was actually merged.
	* pph-streamer.c (pph_trace_tree): Add a boolean parameter specifying
	whether or not the tree was actually merged.  Change output to
	correspond.  Update callers.

2011-10-16   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_dump_chain): New.
	* pph-streamer.c (pph_trace_tree): Filter expressions from trace.
	Print tree code.
	* pph.c (pph_dump_tree_name): Add print newline.
	(pph_dump_namespace): Remove print space.
	(pph_dump_binding): Factor out dumping a chain.
	(pph_dump_chain): New.
	* pph-streamer-in.c (pph_in_mergeable_binding_level): Use
	pph_dump_chain.
	(pph_read_file_1): Change location of namespace dump.
	* pph-streamer-out.c (pph_tree_matches): Remove redundant test.
	(pph_out_tree_vec_1): Removed.
	(pph_out_tree_vec): Takes core implementation from pph_out_tree_vec_1.
	(pph_out_tree_vec_unchain): New. Takes core implementation from
	pph_out_tree_vec_1.
	(pph_out_mergeable_tree_vec): Likewise.
	(pph_out_tree_vec_filtered): Likewise.
	(chain2vec_filter): Prevent null filter.
	(chain2vec): New.  Handles case above.
	(pph_out_chain_1):  Removed.
	(pph_out_chain):  Takes core implementation from pph_out_chain_1.
	(pph_out_chain_filtered):  New.  Takes core implementation from
	pph_out_chain_1.
	(pph_out_mergeable_chain_filtered): Likewise.

2011-10-14   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (extern pph_dump_binding): New.
	* pph.c (pph_dump_binding): New.
	(pph_dump_namespace): Call pph_dump_binding instead of inlining it.
	* pph-streamer-in.c (pph_in_binding_level): Return to original value
	return.  Modify callers to match.
	(pph_in_binding_level_1): New.
	(pph_in_mergeable_binding_level): New.
	(pph_decl_already_emitted): New.
	(pph_in_symtab): Filter emmission by pph_decl_already_emitted.
	(pph_in_identifiers): Fix comment.
	(pph_in_scope_chain): Remove.
	(pph_read_file_1): Call pph_in_mergeable_binding_level instead of
	pph_in_scope_chain.
	* pph-streamer-out.c (pph_out_binding_level_1): Handle only the parts
	of bindings that do not differ with merging.
	(pph_out_binding_level): Handle non-merging bindings.
	(pph_out_mergeable_binding_level): New.
	(pph_out_scope_chain): Rename to pph_out_global_binding.  Call
	pph_out_mergeable_binding_level instead of pph_out_binding_level_1.


2011-10-14   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_mergeable_tree): Remove.  Update all users.
	(pph_in_chain_1): Rename from pph_in_chain.
	Add argument CHAIN.
	(pph_in_chain): Call pph_in_chain_1.
	(pph_in_mergeable_chain): Likewise.
	(pph_in_tcc_declaration): Add documentation on why reading
	DECL_CHAIN is necessary.
	(pph_in_tree_1): Prevent getting DECL_CHAIN clobbered after
	merging into CHAIN.
	* pph-streamer-out.c (pph_out_tree_vec_1): Add argument UNCHAIN.
	Update all users.
	(pph_out_tcc_declaration): Add documentation on why writing
	DECL_CHAIN is necessary

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_tree_1): Do not call pph_trace_tree
	unless flag_pph_tracer is set.

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_tree_1): Rename from pph_in_any_tree.
	Update all users.
	Do not call pph_trace_tree unless flag_pph_tracer is set.

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_tree_1): Rename from pph_out_any_tree.
	Update all users.

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_mergeable_tree): Remove.  Update
	all users.
	(pph_tree_matches): Handle PPHF_NONE.
	(vec2vec_filter): New.
	(pph_out_tree_vec_1): Rename from pph_out_tree_vec.
	Add arguments FILTER, MERGEABLE and REVERSE.
	Call vec2vec_filter.
	(pph_out_tree_vec): Call pph_out_tree_vec_1.
	(pph_out_tree_vec_filtered): Likewise.
	(chain2vec_filter): New.
	(pph_out_mergeable_links): Remove.
	(pph_out_chain_1): Rename from pph_out_chain_1.
	(pph_out_chain): Call pph_out_chain_1.
	(pph_out_chain_filtered): Likewise.
	(pph_out_mergeable_chain_filtered): Likewise.
	(pph_out_tree_common): Asser that T is not a DECL.
	(pph_out_tcc_type): Remove FIXME comment.

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_merge_name): Do not mangle names for
	builtin functions.

2011-10-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_mergeable_tree): Fix comment.
	(pph_read_tree): Move to pph-streamer.c.
	(pph_in_location): Rename from pph_read_location.
	(pph_read_location): Move to pph-streamer.c.
	(pph_in_mergeable_chain): Call pph_in_hwi.
	(pph_in_any_tree): Fix comment.
	* pph-streamer-out.c (pph_write_tree): Move to pph-streamer.c.
	(pph_out_location): Rename from pph_write_location.
	(pph_write_location): Move to pph-streamer.c.
	* pph-streamer.c (pph_write_tree): Move from pph-streamer-out.c.
	Make static.
	(pph_read_tree): Move from pph-streamer-in.c.  Make static.
	(pph_input_location): Move from pph-streamer-in.c.  Rename
	from pph_read_location.
	(pph_output_location): Move from pph-streamer-out.c. Rename
	from pph_out_location.
	* pph-streamer.h (pph_write_tree): Remove.
	(pph_write_location): Remove.
	(pph_read_tree): Remove.
	(pph_read_location): Remove.
	(pph_out_location): Declare.
	(pph_out_tree): Declare.
	(pph_in_location): Declare.
	(pph_in_tree): Declare.

2011-10-12   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (enum pph_trace_type): Remove.
	(pph_trace): Likewise.
	(pph_trace_tree): Likewise.
	(pph_trace_uint): Likewise.
	(pph_trace_bytes): Likewise.
	(pph_trace_string): Likewise.
	(pph_trace_string_with_length): Likewise.
	(pph_trace_location): Likewise.
	(pph_trace_chain): Likewise.
	(pph_trace_bitpack): Likewise.
	(pph_new_trace_tree): Rename pph_trace_tree.
	Remove unused stream parameter.
	* pph-streamer.c (enum pph_trace_type): Remove.
	(pph_trace): Likewise.
	(pph_trace_tree): Likewise.
	(pph_trace_uint): Likewise.
	(pph_trace_bytes): Likewise.
	(pph_trace_string): Likewise.
	(pph_trace_string_with_length): Likewise.
	(pph_trace_location): Likewise.
	(pph_trace_chain): Likewise.
	(pph_trace_bitpack): Likewise.
	(pph_new_trace_tree): Rename pph_trace_tree.
	Remove unused stream parameter.
	* pph-streamer-out.c (pph_out_any_tree):  Call new pph_trace_tree
	instead of old pph_new_trace_tree.
	* pph-streamer-in.c (pph_in_any_tree): Call new pph_trace_tree
	instead of old pph_new_trace_tree.
	(pph_in_location): Change lead comment.

2011-10-12   Lawrence Crowl  <crowl@google.com>

	* pph-streamer-out.c (pph_write_any_tree):  Rename to pph_out_any_tree.
	(pph_write_mergeable_links):  Rename to pph_out_mergeable_links.
	(pph_write_tree_body):  Rename to pph_out_tree_body.
	(pph_write_tree_header):  Rename to pph_out_tree_header.
	* pph-streamer-in.c (pph_read_any_tree):  Rename to pph_in_any_tree.
	(pph_read_tree_body):  Rename to pph_in_tree_body.
	(pph_read_tree_header):  Rename to pph_in_tree_header.

2011-10-12   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_merge_name): New.
	* pph-streamer.c (pph_merge_name): New.
	* pph-streamer-out.c (pph_out_mergeable_tree_vec): Emit the vector
	in declaration order.
	(pph_out_merge_name): New.
	(pph_write_any_tree): Use pph_out_merge_name instead of raw code.
	* pph-streamer-in.c (pph_match_to_link): Use pph_merge_name.
	(pph_in_binding_level): Also merge members of structs.
	(pph_read_any_tree): Save read tree to determine if it is different
	from the tree to be used.

2011-10-12   Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (struct language_function): Rename x_returns_value
	to returns_value.
	Rename x_returns_null to returns_null.
	Rename x_returns_abnormally to returns_abnormally.
	Change all users.
	* pph-streamer-in.c (pph_in_mergeable_chain): Make static.
	* pph-streamer-out.c (pph_out_mergeable_chain): Make static.
	(pph_write_any_tree): Fix C90 warning.

2011-10-12   Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (pushdecl_into_namespace): Remove.
	(print_namespace): Remove.
	* name-lookup.c (add_decl_to_level): Remove unnecessary braces.
	(pushdecl_into_namespace): Remove.
	(print_namespace): Remove.
	* parser.c: Remove ENABLE_CHECKING checks around debugging
	functions.
	(eof_token): Make static.
	(cp_lexer_dump_tokens): Make static.
	(cp_debug_print_tree_if_set): Call print_node_brief.
	(cp_debug_print_context): Likewise.
	(cp_debug_print_unparsed_function): Likewise.
	(cp_lexer_finished_p): Remove.  Update all callers.
	(cp_lexer_get_tokens): Remove.  Update all callers.
	(cp_lexer_token_position): Make static.
	(cp_lexer_purge_token): Merge from mainline.
	(cp_lexer_start_debugging): Set cp_lexer_debug_stream to stderr.
	(cp_lexer_stop_debugging): Set cp_lexer_debug_stream to NULL.
	(cp_parser_declaration): Merge from mainline.
	(cp_parser_class_specifier_1): Likewise.
	(cp_parser_function_definition_from_specifiers_and_declarator):
	Likewise.
	(the_parser): Make static.
	* parser.h (eof_token): Remove.
	(the_parser): Remove.
	(cp_lexer_dump_tokens): Remove.
	(cp_lexer_get_tokens): Remove.
	(cp_lexer_token_position): Remove.
	* pph-streamer.h (pph_add_include): Remove duplicate declaration.

2011-10-11   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_tree_header): Handle AGGR_INIT_EXPR.
	* pph-streamer-out.c (pph_write_tree_header): Likewise.

2011-10-11   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_reading_includes): Remove.  Update all users.
	(pph_in_include): Call pph_add_include with the newly
	materialized stream.
	(pph_in_line_table_and_includes): Document differences between
	non-PPH compiles and PPH compiles wrt line table behaviour.
	Modify assertions accordingly.
	(pph_read_tree_header): Tidy.
	(report_validation_error): Change error() call to warning().
	(pph_image_already_read): Remove.  Update all users.
	(pph_read_file_1): If STREAM->IN_MEMORY_P is set, return.
	Call pph_mark_strea_read.
	(pph_add_read_image): Remove.
	(pph_read_file): Change return type to pph_stream *.  Update all
	users.
	(pph_reader_finish): Remove.
	* pph-streamer-out.c (pph_writer_init): Tidy.
	(pph_add_include): Remove.
	(pph_get_marker_for): Always consult the pre-loaded cache first.
	(pph_writer_add_include): New.
	* pph-streamer.c (pph_read_images): Make static.
	(pph_init_preloaded_cache): Make static.
	(pph_streamer_init): New.
	(pph_streamer_finish): New.
	(pph_find_stream_for): New.
	(pph_mark_stream_read): New.
	(pph_stream_open): Call pph_find_stream_for.  If the stream
	already exists, return it.
	(pph_add_include): Move from pph-streamer-in.c.  Add new
	argument STREAM.
	(pph_cache_lookup_in_includes): Add new argument STREAM.
	Update all users.
	* pph-streamer.h (pph_read_images): Remove extern declaration.
	Move field INCLUDES out of union W.  Update all users.
	Add field IN_MEMORY_P.
	(pph_streamer_init): Declare.
	(pph_streamer_finish): Declare.
	(pph_mark_stream_read): Declare.
	(pph_add_include): Declare.
	(pph_writer_add_include): Declare.
	* pph.c (pph_include_handler): Call pph_writer_add_include.
	(pph_init): Call pph_streamer_init.
	(pph_finish): Call pph_streamer_finish.

2011-10-10   Lawrence Crowl  <crowl@google.com>

	* pph.h (pph_dump_location): New.
	* pph.c (pph_dump_location): New.
	(pph_dump_min_decl): Use new pph_dump_location.
        (pph_dump_tree_name): Use decl_as_* from cxx-pretty-print.h for decls,
	types, and exprs.
	(pph_include_handler): Use flag_pph_tracer instead of flag_pph_debug.
	(pph_init): Likewise.
	* pt.c (pph_dump_tinst_level): Add call to pph_dump_location.
	(pph_dump_spec_entry_slot): Add dump labels.
	* pph-streamer.h (pph_new_trace_tree): New.
	* pph-streamer.c (pph_new_trace_tree): New.
	(pph_stream_close): Use flag_pph_tracer instead of flag_pph_debug.
	* pph-streamer-in.c (pph_in_uchar): Remove tracing.
	(pph_in_uint): Likewise.
	(pph_in_bytes): Likewise.
	(pph_in_string): Likewise.
	(pph_in_bitpack): Likewise.
	(pph_in_location): Likewise.
	(pph_in_bitpack): Likewise.
	(pph_in_linenum_type): Move in source file.
	(pph_in_source_location): Likewise.
	(pph_in_linetable_marker): Likewise.
	(pph_in_line_map): Likewise.
	(pph_in_include): Likewise.
	(pph_in_line_table_and_includes): Likewise.
	(pph_in_ld_base): Likewise.
	(pph_in_ld_min): Likewise.
	(pph_in_tree_pair_vec): Likewise.
	(pph_in_mergeable_chain): Likewise.
	(pph_match_to_overload): Likewise.
	(pph_match_to_function): Likewise.
	(pph_match_to_link): Likewise.
	(pph_search_in_chain): Likewise.
	(pph_prepend_to_chain): Likewise.
	(pph_in_tree_common): Likewise.
	(pph_in_ld_fn): Likewise.
	(pph_in_scope_chain): Likewise.
	(wrap_macro_def): Likewise.
	(report_validation_error): Likewise.
	(pph_in_identifiers): Likewise.
	(pph_in_symtab_action): Likewise.
	(pph_in_cgraph_node): Likewise.
	(pph_in_symtab): Likewise.
	(pph_in_linenum_type): Likewise.
	(pph_in_source_location): Likewise.
	(pph_in_line_map): Likewise.
	(pph_in_include): Likewise.
	(pph_in_line_table_and_includes): Likewise.
	(pph_in_tcc_type): Likewise.
	(pph_image_already_read): Likewise.
	(pph_read_file_1): Likewise.
	(pph_add_read_image): Likewise.
	(pph_read_file): Likewise.
	(pph_in_chain): Move in source file.  Remove tracing.
	(pph_in_tree): Reimplement in terms of pph_read_any_tree.
	Move in source file.  Remove tracing.
	(pph_in_mergeable_tree): Likewise.
	(pph_read_tree): Reimplement in terms of pph_read_any_tree.
	Move in source file.
	(pph_read_any_tree): Add call to pph_new_trace_tree.
	* pph-streamer-in.c (pph_out_uchar): Remove tracing.
	(pph_out_uint): Likewise.
	(pph_out_bytes): Likewise.
	(pph_out_string): Likewise.
	(pph_out_string_with_length): Likewise.
	(pph_out_bitpack): Likewise.
	(pph_begin_section): Move in source file.
	(pph_out): Move in source file.  Rename pph_out_block.
	(pph_end_section): Move in source file.
	(pph_write_location) Likewise.
	(pph_out_location) Likewise.
	(pph_out_chain) Likewise.
	(pph_out_header) Likewise.
	(pph_out_body) Likewise.
	(pph_flush_buffers) Likewise.
	(pph_cache_should_handle) Likewise.
	(pph_out_ld_base) Likewise.
	(pph_out_ld_min) Likewise.
	(pph_tree_matches) Likewise.
	(pph_out_cxx_binding_1) Likewise.
	(pph_out_cxx_binding) Likewise.
	(pph_out_label_binding) Likewise.
	(pph_out_tree_common) Likewise.
	(pph_out_ld_fn) Likewise.
	(pph_out_tree_pair_vec) Likewise.
	(pph_out_scope_chain) Likewise.
	(pph_out_identifiers) Likewise.
	(pph_out_symtab_action) Likewise.
	(pph_out_cgraph_node) Likewise.
	(pph_out_symtab) Likewise.
	(pph_out_linenum_type) Likewise.
	(pph_out_source_location) Likewise.
	(pph_out_linetable_marker) Likewise.
	(pph_out_line_map) Likewise.
	(pph_out_include) Likewise.
	(pph_filename_eq_ignoring_path) Likewise.
	(pph_get_next_include) Likewise.
	(pph_out_line_table_and_includes) Likewise.
	(pph_write_file) Likewise.
	(pph_out_tcc_type) Likewise.
	(pph_write_tree) Likewise.
	(pph_write_mergeable_tree) Likewise.
	(pph_add_include) Likewise.
	(pph_writer_init) Likewise.
	(pph_out_chain): Move in source file.  Remove tracing.
	(pph_out_mergeable_chain): Likewise.
	(pph_out_tree_1) Remove.  Replace all calls with pph_out_tree.
	(pph_out_tree) Reimplement in terms of pph_write_any_tree.
        Move in source file.  Remove tracing.
	(pph_out_mergeable_tree) Likewise.
	(pph_write_tree) Reimplement in terms of pph_write_any_tree.
        Move in source file.

2011-10-07   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (typedef pph_stream): Move to pph.h.
	(enum pph_symtab_action): Likewise.
	(enum pph_record_marker): Likewise.
	(enum pph_tag): Likewise.
	(extern pph_out_uint): Liekwise.
	(extern pph_out_location): Likewise.
	(extern pph_out_tree): Likewise.
	(extern pph_out_record_marker): Likewise.
	(extern pph_add_decl_to_symtab): Likewise.
	(extern pph_in_uint): Likewise.
	(extern pph_in_location): Likewise.
	(extern pph_in_tree): Likewise.
	(extern pph_record_marker): Likewise.
	(extern struct binding_table_s): Likewise.
	(extern pph_out_binding_table): Likewise.
	(extern pph_in_binding_table): Likewise.
	(extern pph_out_pending_templates_list): Likewise.
	(extern pph_out_spec_entry_tables): Likewise.
	(extern pph_in_pending_templates_list): Likewise.
	(extern pph_in_spec_entry_tables): Likewise.
	(pph_writer_enabled_p): Likewise.
	(pph_enabled_p): Likewise.

	* pph.h (cp_token_hunk): Remove unused.
	(cp_token_hunk_ptr): Likewise.
	(DEF_VEC_P (cp_token_hunk_ptr)): Likewise.
	(DEF_VEC_ALLOC_P (cp_token_hunk_ptr,gc)): Likewise.
	(#error diagnostic): Likewise.
	(extern pph_tree_code_text): Move to pph-streamer.h.
	(extern pph_dump_min_decl): Likewise.
	(extern pph_dump_namespace): Likewise.

	* pph.h: Remove includes for hashtab.h, line-map.h, parser.h, and
	timevar.h.
	* pph-streamer.h: Add include pph.h.
	* pph-streamer-in.c: Add include parser.h.
	* pph-streamer-out.c: Likewise.
	* decl.c: Include pph.h instead of pph-streamer.h.
	* semantics.c: Likewise.
	* parser.c: Remove include of pph-streamer.h.
	* name-lookup.c: Likewise.
	* Make-lang.in: Adjust dependences to reflect the above.

2011-10-07   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h: Remove #if 0 scaffolding.

2011-10-07   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_in_chain): Moved to pph-streamer-in.c as extern.
	(pph_read_mergeable_tree): Make static in pph-streamer-in.c.
	(pph_read_mergeable_chain): Likewise
	(pph_in_mergeable_tree): Moved to pph-streamer-in.c as static.
	(pph_in_mergeable_chain): Likewise.
	(pph_in_bitpack): Likewise.
	(pph_in_chain): Likewise.
	(pph_out_location): Moved to pph-streamer-out.c extern.
	(pph_out_tree): Likewise.
	(pph_out_tree_1): Moved to pph-streamer-out.c as static.
	(pph_out_mergeable_tree): Likewise.
	(pph_tree_code_to_tag): Comment unused.
	(pph_tag_to_tree_code): Likewise.

2011-10-07   Lawrence Crowl  <crowl@google.com>

	* pph-streamer.h (pph_out_tree_array): Remove unused.
	(pph_in_tree_array): Remove unused.
	(pph_in_tree_VEC): Remove unused.
	(pph_out_uint): Moved to pph-streamer-out.c as extern.
	(pph_out_record_marker): Likewise.
	(pph_out_chain): Moved to pph-streamer-out.c as static.
	(pph_out_mergeable_chain): Likewise.
	(pph_out_bitpack): Likewise.
	(pph_in_uint): Moved to pph-streamer-in.c as extern.
	(pph_in_location): Likewise.
	(pph_in_tree): Likewise.
	(pph_in_record_marker): Likewise.
	(pph_in_uhwi): Moved to pph-streamer-in.c as static.
	(pph_in_hwi): Likewise.
	(pph_in_uchar): Likewise.
	(pph_in_bytes): Likewise.

2011-10-06   Lawrence Crowl  <crowl@google.com>

        * pt.c (pph_in_pending_templates_list): Send pph logging to
	the pph log file.
	* pph.c (pph_tree_code_text): Correct specification of enum bound.
	* pph-streamer-in.c (pph_in_namespace_tree_vec):  Remove.
	(pph_in_binding_level): Change to mutator.  Mutate early so that
	the result is usable while reading sub-trees.
	(pph_in_tcc_declaration): Comment on redundancy.
	(pph_match_to_overload): New.
	(pph_match_to_function): New.
	(pph_match_to_link): New.
	(pph_search_in_chain): New.
	(pph_prepend_to_chain): New.
	(pph_merge_into_chain): New.
	(pph_read_namespace_tree): Rename to pph_read_any_tree.  Mutate
	a specific chain rather than mutate a namespace.
	(pph_read_tree): Move within source.
	(pph_read_mergeable_tree): New.
        (pph_read_mergeable_chain): Chaining is now done by
	pph_in_mergeable_tree.
	* pph-streamer-out.c (pph_out_namespace_tree_vec):  Rename to
	pph_out_mergeable_tree_vec.  Remove unneeded namespace parameter.
	(pph_out_namespace_tree_vec_filtered): Remove unneeded.
	(pph_write_namespace_chain): Replace with pph_write_mergeable_chain.	
	(pph_write_mergeable_links): New.
	(pph_out_namespace_chain_filtered):  Rename to
	pph_out_mergeable_chain_filtered.  Remove unneeded namespace parameter.
	(pph_out_binding_level_1): Adjust code to track the above changes.
	->static_decls are already in declaration order, factor them out of
	mergable tests.
	(pph_out_tcc_declaration): Comment on redundancy.
	(pph_out_tcc_type): Comment on redundancy.
	(pph_write_namespace_tree): Rename to pph_write_any_tree.
	Change namespace parameter to boolean.  Emit location info for merging.
	(pph_write_mergeable_tree): New.
	* pph-streamer.h: Modify function declarations to reflect the above.
	(pph_out_namespace_tree): Rename to pph_out_mergeable_tree.  Remove
	unneeded namespace argument.
	(pph_out_namespace_tree_1): Fold into pph_out_mergeable_tree.
	(pph_out_namespace_chain): Rname to pph_out_mergeable_chain.  Remove
	unneeded namespace argument.
	(pph_in_namespace_tree): Rname to pph_in_mergeable_tree.  Change
	argument to chain instead of namespace.
	(pph_in_namespace_chain): Rname to pph_in_mergeable_chain.  Change
	argument to chain instead of namespace.

2011-10-05   Diego Novillo  <dnovillo@google.com>

	* pt.c (reregister_specialization): Call htab_find_slot with
	NO_INSERT.

2011-10-04   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (pph_cache_find): New.
	Replace pph_cache_select/pph_cache_get combinations with it.

2011-10-03   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (enum pph_tag): Define.
	(struct pph_cache_entry): Add field TAG.
        (pph_cache_insert_at): Add new argument TAG.
        Update all users.
        (pph_cache_lookup): Likewise.
        (pph_cache_lookup_in_includes): Likewise.
        (pph_cache_add): Likewise.
        (pph_out_record_marker): Likewise.
        (pph_in_record_marker): Add new argument *TAG_P.
        Read *TAG_P.  Assert that it is a valid tag.
        (pph_cache_get): Call pph_cache_get_entry.
	(pph_tag_is_tree_code): New.
        (pph_tree_code_to_tag): New.
        (pph_tag_to_tree_code): New.
	* pph-streamer-in.c (ALLOC_AND_REGISTER): Add new argument
        TAG.  Update all users.
        (ALLOC_AND_REGISTER_ALTERNATE): Likewise.
	(pph_in_start_record): Add new argument EXPECTED_TAG.  Update
        all users.
	(pph_in_c_language_function): Inline into ...
	(pph_in_language_function): ... here.
	* pph-streamer-out.c (pph_get_marker_for): Add argument TAG.
        Update all users.
	(pph_out_reference_record): Likewise.
	(pph_out_start_record): Likewise.
	(pph_out_start_tree_record): Re-enable state mutation
        detection.
	(pph_out_c_language_function): Inline into ...
	(pph_out_language_function): ... here.

2011-10-01   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_namespace_tree): Initialize EXPR.
	* pph-streamer-out.c (pph_get_marker_for): Handle NULL values
        for INCLUDE_IX_P and IX_P.

2011-09-30   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_cache_insert_at): Fix documentation.

2011-09-29   Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_debug_parser): Add location information on
        the about-to-be-parsed token.

2011-09-29   Diego Novillo  <dnovillo@google.com>

        * pph-streamer-in.c (pph_in_start_record): Handle
        PPH_RECORD_START_MUTATED.
	(pph_read_namespace_tree): Re-organize to handle
        PPH_RECORD_START_MUTATED.
	* pph-streamer-out.c (pph_out_start_tree_record): Change
        return value to enum pph_record_marker.  Update all users.
        If the signature of the tree node changed, change the marker
        to be PPH_RECORD_START_MUTATED (disabled for now).
        Handle PPH_RECORD_START_MUTATED.
	(pph_write_namespace_tree): Re-organize to handle
        PPH_RECORD_START_MUTATED.
	* gcc/cp/pph-streamer.h (enum pph_record_marker): Rename
        PPH_RECORD_MREF to PPH_RECORD_START_MUTATED.  Update all
        users.
	(pph_in_record_marker): Handle PPH_RECORD_START_MUTATED.

2011-09-28   Diego Novillo  <dnovillo@google.com>

        * pph-streamer-out.c (pph_get_marker_for): Factor out of
        pph_start_record.
	(pph_out_reference_record): Rename from pph_out_start_ref_record.
	(pph_out_start_tree_record): Detect when a tree's signature
        should be re-checked.

2011-09-28   Diego Novillo  <dnovillo@google.com>

        * pph-streamer-in.c (pph_is_reference_marker): Move to
        pph-streamer.h.
	(pph_read_namespace_tree): Call tree_needs_signature to
        determine if EXPR should be signed.
        Call pph_get_signature.
	* pph-streamer.c (pph_cache_sign): Add argument CRC.
        Change return value to void.  Update all users.
	(pph_get_signature): New.
	* pph-streamer.h (pph_cache_sign): Declare.
        (pph_get_signature): Declare.
        (pph_is_reference_marker): Move from pph-streamer-in.c.
	(tree_needs_signature): New.

2011-09-27   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_namespace_tree): Do not insert
        constants in the cache.
	* pph-streamer-out.c (pph_cache_should_handle): New.
	(pph_out_start_ref_record): Factor out of ...
	(pph_out_start_record): ... here.
        Change return value meaning; true means 'all done'; false
        means 'caller should write data out'.  Update all callers.
	(pph_out_start_tree_record):  New.
	(pph_write_builtin): Remove.  Update all users.
	(pph_write_namespace_tree): Call pph_out_start_tree_record.
	* pph-streamer.c (pph_cache_insert_at): Assert that we are
        not trying to insert the same data more than once.
	* pph-streamer.h (enum pph_record_marker): Add new value
        PPH_RECORD_START_NO_CACHE.
	(pph_in_record_marker): Handle it.

2011-09-27   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_namespace_tree): Do not insert
        builtins into the cache.
        Call pph_cache_sign for decls and types.
	* pph-streamer-out.c (pph_write_builtin): New.
	(pph_write_namespace_tree): Call it.
        Handle builtins before calling pph_out_start_record.
	* pph-streamer.c (pph_init_preloaded_cache): Add comment.
	(pph_stream_open): Initialize preloaded_cache field.
	(pph_cache_insert_at): Assert that *MAP_SLOT is NULL.  Disable
        for now.
	(pph_cache_sign): New.
        (pph_cache_get): Move to pph-streamer.h.
	* pph-streamer.h (pph_cache_entry): Change type of field crc_nbytes
        to size_t.
        (pph_stream): Add field preloaded_cache.
	(pph_cache_select): Factor out of ... 
	(pph_cache_get): ... here.
        Change all callers to call pph_cache_select first.
	(pph_cache_get_entry): New.

2011-09-26   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (enum pph_record_marker): Add PPH_RECORD_MREF
        value.
        (pph_cache_entry): Declare.
        (pph_cache): Rename from pph_pickle_cache.
        Change field v to be a VEC of pph_cache_entry elements.
        Update all users.

2011-09-19   Lawrence Crowl  <crowl@google.com>

	* pph-streamer-out.c (pph_out_binding_level_1): Read this_entity first.
	Call different routines when it is a namespace.
	(pph_write_tree): Move most of body to pph_write_namespace_tree.
	(pph_write_namespace_tree): As above.  If there is an enclosing
	namespace, write additional information needed for merging.
	(pph_out_namespace_tree_vec) New.
	(pph_out_namespace_tree_vec_filtered) New.
	(pph_write_namespace_chain) New.
	(pph_out_namespace_chain_filtered) New.
	* pph-streamer-in.c (pph_in_binding_level): Read this_entity first.
	Call different routines when it is a namespace.
	(pph_read_tree): Move most of body to pph_read_namespace_tree.
	(pph_read_namespace_tree): As above.  If there is an enclosing
	namespace, read additional information needed for merging.
	Merging is currently not done.
	(pph_read_namespace_chain): New.
	(pph_in_namespace_tree_vec): New.
	* pph-streamer.h (pph_write_namespace_tree): New.
	(pph_write_namespace_chain): New.
	(pph_read_namespace_tree): New.
	(pph_read_namespace_chain): New.
	(pph_out_namespace_tree_1): New.
	(pph_out_namespace_tree): New.
	(pph_out_tree_VEC): Deleted, redundant with pph-streamer-out.c.
	(pph_out_namespace_chain): New.
	(pph_in_namespace_tree): New.
	(pph_in_namespace_chain): New.

2011-09-17   Lawrence Crowl  <crowl@google.com>

	* pph.h (pph_tree_code_text): New.
	(pph_dump_min_decl): New.
	* pph.c (pph_tree_code_text): New.  Update users of tree_code_name
	to call this function instead, here and in other files.
	(pph_dump_min_decl): New.
	(pph_init): Adjust debug value to preprocessor's value.
	* pph-streamer-in.c (pph_read_tree_header): Move work unrelated to
	tree headers out of this function.
	* (pph_read_tree): Move that work here.
	* pt.c (pph_in_spec_entry_htab): Use pph_logfile instead of stderr.
	(pph_out_spec_entry_tables): Likewise.
	(pph_in_spec_entry_tables): Likewise.

2011-09-13   Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/parser.o): Add dependency on CXX_PPH_STREAMER_H.
	* parser.c: Include pph-streamer.h
	* decl.c (cp_rest_of_decl_compilation): Call pph_writer_enabled_p.
	* pph-streamer-in.c (pph_read_file_1): Likewise.
	* semantics.c (expand_or_defer_fn_1): Likewise.
	* pph-streamer.h (pph_writer_enabled_p): New.
	(pph_enabled_p): Move from pph.h.
	* pph.c (pph_init): Call pph_writer_enabled_p.
	* pph.h: Move to pph-streamer.h.

2011-09-09   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_image_already_read): New.
	(pph_read_file_1): Call pph_image_already_read.  If it returns
	true, return after reading the line table.
	(pph_add_read_image): New.
	(pph_read_file): Change return value to void.  Update all callers.
	Call pph_add_read_image.
	* pph-streamer-out.c (pph_add_include): Remove second argument.
	Update all callers.
	Do not add INCLUDE to pph_read_images.
	* pph-streamer.h (pph_add_include): Update prototype.

2011-09-09   Diego Novillo  <dnovillo@google.com>

	* class.c (finish_struct_methods): Make extern.
	* cp-tree.h (finish_struct_methdods): Declare.
	* pph-streamer-in.c (pph_in_tcc_type): Call it.
	* pph-streamer.h (PPHF_NO_PREFS): Define.
	* pph-streamer-out.c (pph_tree_matches): Use it to filter trees
	present in the preloaded cache.
	(pph_out_scope_chain): Call pph_out_binding_level_1 with
	PPH_NO_PREFS in the filter.

2011-09-09   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_stream_close): Handle NULL streams.

2011-09-08   Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_lexer_dump_tokens): Properly count number of printed
	tokens to know when to stop.
	(cp_debug_parser): Reduce token window size to 20.

2011-08-25  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_read_tree_body): Use accessor macros for
	all fields. Use REAL_IDENTIFIER_TYPE_VALUE instead of TREE_TYPE
	for the IDENTIFIER_NODE case.
	* pph-streamer-out.c (pph_write_tree_body): Likewise.

2011-08-25   Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (struct saved_scope): Add field x_brace_nesting.
	* parser.c (cp_lexer_token_is_open_brace): New.
	(cp_lexer_token_is_close_brace): New.
	(cp_lexer_get_preprocessor_token): Call them.
	Increase scope_chain->x_brace_nesting for open braces, decrease
	for closing braces.
	* pph.c (pph_is_valid_here): New.  Return false if
	scope_chain->x_brace_nesting is greater than 0.
	(pph_include_handler): Call it.

2011-08-25  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_is_reference_marker): Handle PPH_RECORD_PREF.
	(pph_in_start_record): Likewise.
	* pph-streamer-out.c (pph_out_start_record): Add extra lookup in
	pph_preloaded_cache if lookup in current and included streams failed.
	* pph-streamer.c (pph_preloaded_cache): New.
	(pph_cache_preload): Change first parameter to a pph_pickle_cache*
	from a pph_stream*. Update all users.
	(pph_cache_init): New.
	(pph_init_preloaded_cache): New local variable.
	(pph_stream_open): Use pph_cache_init. Do not call pph_cache_preload.
	(pph_cache_get): Add a new pph_record_marker parameter which we
	use to determine to type of get to do. Update all users.
	* pph-streamer.h (enum pph_record_marker): Add PPH_RECORD_PREF.
	(pph_in_record_marker): Handle PPH_RECORD_PREF.
	* pph.c (pph_init): Call pph_init_preloaded_cache.

2011-08-25   Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/semantics.o): Add dependency on
	$(CXX_PPH_STREAMER_H).
	* decl.c (start_preparsed_function): Remove call to
	pph_add_decl_to_symtab.
	* pph-streamer-in.c (pph_in_ld_min): Call pph_in_hwi instead
	of pph_in_uint.
	(pph_in_struct_function): Do not return the allocated struct
	function.
	Add argument DECL.  Update all callers.
	Allow references to an cached function.
	(pph_in_cgraph_node): New.
	(pph_in_symtab): Call it for PPH_SYMTAB_EXPAND records.
	Call cgraph_finalize_function instead of expand_or_defer_fn.
	(pph_in_tcc_declaration): Adjust DECL_EXTERNAL for
	DECL_NOT_REALLY_EXTERN functions.  Document why.
	* pph-streamer-out.c (pph_out): Assert that the call to fwrite
	worked.
	(pph_out_tree_vec): Output the length as a HOST_WIDE_INT.
	Document why.
	(pph_out_chained_tree): Remove unused function.
	(pph_out_cgraph_node): New.
	(pph_out_symtab): Call it for PPH_SYMTAB_EXPAND records.
	(pph_add_decl_to_symtab): Add arguments ACTION, TOP_LEVEL and
	AT_END.  Update all callers.
	* pph-streamer.h (enum pph_symtab_action): Rename from
	pph_symtab_marker.  Change values to PPH_SYMTAB_DECLARE and
	PPH_SYMTAB_EXPAND.  Update all users.
	(struct pph_symtab_entry): Declare.
	(struct pph_symtab): Remove field 'm'.  Change field 'v' to be
	VEC(pph_symtab_entry,heap).  Update all users.
	(pph_out_uhwi): New.
	(pph_out_hwi): New.
	(pph_in_uhwi): New.
	(pph_in_hwi): New.
	* semantics.c: Include pph-streamer.h.
	(expand_or_defer_fn_1): Call pph_add_decl_to_symtab.

2011-08-24  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (ALLOC_AND_REGISTER): Take a pph_pickle_cache*
	as a first parameter instead of a pph_stream*.
	Update all users.
	(ALLOC_AND_REGISTER_ALTERNATE): Likewise.
	* pph-streamer.c (pph_cache_insert_at): Likewise.
	(pph_cache_lookup): Likewise.
	(pph_cache_add): Likewise.
	(pph_cache_get): Likewise.

2011-08-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_loc_offset): Add FIXME to move this variable
	to pph_stream.encoder.r
	(pph_in_include): New.
	(pph_in_line_table_and_includes): Remove LINETAB parameter. Update
	all users to use global LINE_TABLE instead.
	Remove code moved to new function pph_in_include. And call it.
	(pph_read_file_1): Remove extra parameter in call to
	pph_in_line_table_and_includes.
	* pph-streamer-out.c (pph_out_include): New.
	(pph_get_next_include): Fix comment.
	(pph_out_line_table_and_includes): Remove LINETAB parameter. Update
	all users to use global LINE_TABLE instead.
	Remove code moved to new function pph_out_include. And call it.
	* gcc/cp/pph-streamer.h (pph_stream): Fix indenting.

2011-08-22   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_binding_level): Call pph_in_tree to
	read BL->BLOCKS.
	* pph-streamer-out.c (pph_out_binding_level_1): Call pph_out_tree
	to write BL->BLOCKS.
	(pph_out_symtab): Mark the function as having a body if it has a
	cgraph node associated with it.

2011-08-22   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_tcc_declaration): Factor out
	of pph_read_tree_body.  Handle all decls.
	(pph_in_tcc_type): Factor out of pph_read_tree_body.  Handle
	all types.
	(pph_read_tree_body): Issue a fatal error if a node has not
	been handled.
	* pph-streamer-out.c (pph_out_tcc_declaration): Factor out of
	pph_write_tree_body.  Handle all decls.
	(pph_out_tcc_type): Factor out of pph_write_tree_body.  Handle
	all types.
	(pph_write_tree_body): Issue a fatal error if a node has not
	been handled.

2011-08-19  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_in_includes): Remove.
	(pph_in_linetable_marker): New.
	(pph_in_line_table_and_includes): Renamed from
	pph_in_and_merge_line_table.
	Now handles line_table and includes input in parallel.
	Now returns source_location corresponding to line 1 / col 0
	of the header currently loaded as pph.
	(pph_read_file_1): Read line_table and includes before replaying
	tokens. Use location returned by pph_in_line_table_and_includes
	as forced token location for replayed tokens.
	* pph-streamer-out.c (pph_out_includes): Remove.
	(pph_out_linetable_marker): New.
	(pph_filename_eq_ignoring_path): New.
	(pph_get_next_include): New.
	(pph_out_line_table_and_includes): Renamed from pph_out_line_table.
	Now handles output of both the line_table and includes references
	in parallel.
	(pph_write_file): Write out line_table and includes before
	identifiers.
	* pph-streamer.h (enum pph_linetable_marker): New.
	* pph.c (pph_include_handler): Add hack to mimic
	line_table->highest_location behaviour in _cpp_stack_include used
	by the non-pph compiler.

2011-08-18  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_reading_includes): New.
	(pph_in_includes): Add logic to control pph_reading_includes.
	(pph_read_file_1): Only call pph_add_include if reading an include
	from the main file (not from pph_in_includes).
	(pph_read_file): Don't handle adding to pph_read_images here.
	(pph_reader_finish): Free pph_read_images.
	* pph-streamer-out.c (pph_tree_matches): Remove now unused STREAM
	parameter. Update all users.
	(pph_add_include): Changed signature to (stream, bool).
	Update all users.
	Handle adding INCLUDE to pph_read_images here.
	* gcc/cp/pph-streamer.c (pph_read_images): Moved here from
	pph-streamer-in.c
	(pph_stream_close): Free stream->encoder.w.includes.
	(pph_cache_lookup_in_includes): Lookup in pph_read_images.
	Remove now unused STREAM parameter.
	Update all users.
	(pph_cache_get): Index in pph_read_images.
	* pph-streamer.h (pph_stream): Move field includes to
	pph_stream.encoder.w.includes. Update all users.
	* gcc/cp/pph.c (pph_init): Initialize pph_read_images to NULL.
	(pph_finish): Fixed extra space typo.

2011-08-17   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_qual_use_vec): Read Q.LOCUS.
	* pph-streamer-out.c (pph_out_qual_use_vec): Write Q->LOCUS.

2011-08-17   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_get_type_from_index): Remove.
	(pph_in_number): Remove.
	(pph_in_token_value): Handle all cases that read a tree
	with pph_in_tree.
	* pph-streamer-out.c (pph_out_number): Remove.
	(pph_get_index_from_type): Remove.
	(pph_out_token_value): Handle all cases that write a tree
	with pph_out_tree.

2011-08-17   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (pph_out_tree_1): Rename from pph_out_tree_or_ref_1.
	Update all users.
	(pph_out_tree): Rename from pph_out_tree_or_ref.  Update all users.

2011-08-16  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_read_file_1): Set location of replayed
	tokens to column 0 of the line the pph file was included on.

2011-08-16  Gabriel Charette  <gchare@google.com>

	* pph-streamer-out.c (pph_write_location): Better asserts.
	* pph-streamer.h (PPH_NUM_IGNORED_LINE_TABLE_ENTRIES): Set to 2.

2011-08-15   Diego Novillo  <dnovillo@google.com>

    	* name-lookup.c (pph_out_binding_table): Call
    	pph_out_record_marker instead of pph_out_uchar.
    	(pph_in_binding_table): Call pph_in_record_marker instead of
    	pph_in_uchar.
    	* pph-streamer-in.c (pph_read_images): Declare.
    	(pph_is_reference_marker): New.  Update all previous users of
    	PPH_RECORD_SHARED.
    	(pph_in_start_record): Add argument INCLUDE_IX.  Update all
    	users.
    	Handle PPH_RECORD_XREF markers.
    	(pph_in_includes): After reading INCLUDE_NAME, call
    	pph_add_include.
    	(pph_read_file_contents): Move debugging output from ...
    	(pph_read_file): ... here.
    	Change it to return the opened stream.
    	Add STREAM to pph_read_images.
    	(pph_reader_finish): New.
    	(pph_read_file_1): Rename from pph_read_file_contents.  Update
    	all users.
    	* pph-streamer-out.c (pph_out_start_record): Re-write to
    	handle PPH_RECORD_IREF and PPH_RECORD_XREF.
    	(pph_write_file_contents): Embed ...
    	(pph_write_file): ... here.
    	(pph_add_include): Add new argument INCLUDE.  Update all
    	users.
    	(pph_writer_finish): Do nothing if pph_out_stream is NULL.
    	(pph_tree_matches): New.
    	(pph_out_tree_vec_filtered): New.
    	(pph_out_binding_level): Add new argument FILTER.  Update all users.
    	* pph-streamer.c (pph_stream_close_1): Embed ...
    	(pph_stream_close): ... here.
    	Do not traverse the list of includes.
    	(pph_cache_lookup): Factor out of ...
    	(pph_cache_add): ... here.
    	(pph_cache_lookup_in_includes): New.
    	(pph_cache_get): Add new argument INCLUDE_IX.  Update all users.
    	* pph-streamer.h (enum pph_record_marker): Add PPH_RECORD_IREF
    	and PPH_RECORD_XREF.  Remove PPH_RECORD_SHARED.  Update all users.
    	(struct pph_stream): Remove field open_p and nested_p.  Update
    	all users.
    	(enum chain_filter): Remove.  Change values to #define constants.
    	Update all users.
    	(PPHF_NO_XREFS): Define.
    	(pph_out_record_marker): New.
    	(pph_in_record_marker): New.
    	* pph.c (pph_finish): Always call pph_writer_finish.
    	Call pph_reader_finish.

2011-08-12   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_init_read): Do not call lto_reader_init.
	* pph-streamer-out.c (pph_init_write): Do not call lto_streamer_init.
	(pph_out_body): Do not call lto_output_decl_state_streams nor
	lto_output_decl_state_refs.

2011-08-11   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_tree_body): Read
	STATIC_ASSERT_SOURCE_LOCATION and tree_lambda_expr::locus.
	* pph-streamer-out.c (pph_write_tree_body): Write
	STATIC_ASSERT_SOURCE_LOCATION and tree_labmda_expr::locus.

2011-08-11   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_shared_data): Remove.  Update all users.
	(pph_register_shared_data): Remove.  Update all users.

2011-08-10   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_unpack_value_fields): Make static.
	Move down in the file.
	(pph_alloc_tree): Remove.
	(pph_read_tree_body): Factor out of pph_read_tree.
	Call lto_input_tree_pointers.
	(pph_read_tree_header): New.
	(pph_read_tree): Call pph_read_tree_header and
	pph_read_tree_body.
	* pph-streamer-out.c (pph_pack_value_fields): Make static.
	Move down in the file.
	(pph_out_tree_header): Remove.
	(pph_write_tree_body): Factor out of pph_write_tree.
	Call lto_output_tree_pointers.
	(pph_write_tree_header): New.
	(pph_write_tree): Call lto_output_builtin_tree,
	pph_write_tree_header and pph_write_tree_body.
	* pph-streamer.c (pph_is_streamable): Remove.
	(pph_indexable_with_decls_p): Remove.
	(pph_cache_preload): Rename from pph_preload_common_nodes.
	Re-implement using pickle cache in struct pph_stream.
	(pph_hooks_init): Remove setting for all removed hooks.
	(pph_stream_open): Call pph_cache_preload.
	(pph_cache_insert_at): Allow the same pointer to be at two
	different cache locations.
	(pph_cache_add): If IX_P is NULL, do not try to set it.
	* pph-streamer.h (pph_pack_value_fields): Remove.
	(pph_out_tree_header): Remove.
	(pph_unpack_value_fields): Remove.
	(pph_alloc_tree): Remove.
	(pph_read_tree): Update prototype.
	(pph_out_tree): Call pph_write_tree instead of lto_output_tree.
	(pph_out_tree_array): Likewise.
	(pph_out_tree_or_ref_1): Likewise.
	(pph_out_tree_VEC): Likewise.
	(pph_in_tree): Call pph_read_tree instead of lto_input_tree.
	(pph_in_tree_array): Likewise.
	(pph_in_tree_VEC): Likewise.

2011-08-09   Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (CXX_PPH_STREAMER_H): Add DATA_STREAMER_H
	and TREE_STREAMER_H.
	* name-lookup.c: Move pph.h inclusion earlier to avoid
	GCC_DIAG_STYLE error.
	* parser.c: Likewise.
	* pph-streamer-in.c: Likewise.
	* pph-streamer-out.c: Likewise.
	* pph-streamer.c: Likewise.
	* pph-streamer.h: Likewise.
	* pph.c: Likewise.
	* pt.c: Likewise.
	* pph.h: Add GCC_DIAG_STYLE checking.

2011-08-04  Gabriel Charette  <gchare@google.com>

	* decl.c (finish_function): Remove line 0 hack.
	* pph-streamer-in.c (pph_loc_offset): New global variable.
	(pph_read_location): New.
	(pph_in_linenum_type): New.
	(pph_in_source_location): New.
	(pph_in_line_map): New.
	(pph_in_and_merge_line_table): New.
	(pph_read_file_contents): Call pph_in_and_merge_line_table.
	* pph-streamer-out.c (pph_write_location): New.
	(pph_out_linenum_type): New.
	(pph_out_source_location): New.
	(pph_out_line_map): New.
	(pph_out_line_table): New.
	(pph_write_file_contents): Call pph_out_line_table.
	* pph-streamer.c (pph_hooks_init): Init input_location
	and output_location hooks.
	* pph-streamer.h (PPH_NUM_IGNORED_LINE_TABLE_ENTRIES): Define.

2011-08-04   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (string_tables): Declare.
	(pph_init_read): Create a new entry in string_tables and copy
	the string table from STREAM into it.

2011-08-04   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_get_section_data): Remove unused function.
	(pph_free_section_data): Remove unused function.
	(pph_init_read): Do not call lto_set_in_hooks.

2011-08-04   Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_lexer_new_main): Move call to pph_init ...
	(c_parse_file): ... here.
	Call pph_finish only if pph_enabled_p returns true.
	* gcc/cp/pph-streamer-in.c (pph_in_includes): New.
	(pph_read_file_contents): Call it.
	(pph_read_file): Call pph_add_include.
	* pph-streamer-out.c (current_pph_file): Remove.  Update all users.
	(decls_to_register_t) Likewise.
	(decls_to_register): Likewise.
	(pph_out_stream): Declare.
	(pph_out_symtab_marker): Assert that the MARKER fits in an
	unsigned char.
	(pph_out_includes): New.
	(pph_write_file): Make static.  Assume that STREAM is opened and
	closed by the caller.
	(pph_add_include): New.
	(pph_writer_init): Open pph_out_file into pph_out_stream.
	(pph_writer_finish): Close pph_out_stream.  Call pph_write_file
	if no errors were found.
	(pph_add_decl_to_symtab): Rename from pph_add_decl_to_register.
	Update all users.
	* pph-streamer.c (pph_stream_open): Tidy.
	Initialize stream->symtab.
	(pph_stream_close_1): Factor out of ...
	(pph_stream_close): ... here.
	Only call pph_stream_close_1 if STREAM is not nested in another
	PPH file.
	* pph-streamer.h (struct pph_symtab): Declare.
	(pph_stream_ptr): Declare.
	(struct pph_stream): Add fields open_p, nested_p, symtab
	and includes.
	(pph_add_decl_to_symtab): Declare.
	(pph_add_include): Declare.
	(pph_writer_init): Declare.
	(pph_writer_finish): Declare.
	* pph.c (pph_init): Call pph_writer_init if pph_out_file is set.
	(pph_finish): Call pph_writer_finish if pph_out_file is set.
	* pph.h (pph_enabled_p): New.

2011-07-28   Lawrence Crowl  <crowl@google.com>

	* pt.c (pph_in_tinst_level): Put tinst_level list in forward order.

2011-07-28   Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (pph_stream): Move fields OB, OUT_STATE,
	DECL_STATE_STREAM, IB, DATA_IN, PPH_SECTIONS, FILE_DATA and
	FILE_SIZE into a union of structures.
	Update all users.
	* pph-streamer.c (pph_stream_close): Free memory used by tree
	encoding routines.

2011-07-25   Lawrence Crowl  <crowl@google.com>

	* pph.c (pph_dump_tree_name): Make extern.
	* pph.h (pph_dump_tree_name): Make extern.
	* pph-streamer-in.c (pph_read_file_contents): Load pending templates
	list and tables of decl and type template specializations.
	* pph-streamer.c (enum pph_trace_type): Add PPH_TRACE_LOCATION
	enumeration.
	(pph_trace): Add trace for locations.
	(pph_trace_location): New.
	* pph-streamer.h (pph_trace_location): New.
	(pph_out_pending_templates_list): New.
	(pph_in_pending_templates_list): New.
	(pph_out_spec_entry_tables): New.
	(pph_in_spec_entry_tables): New.
	(pph_out_location): New.
	(pph_in_location): New.
	* pph-streamer-out.c (pph_write_file_contents): Save template pending
	instantiation list, decl specialization table, and type specialization
	table.
	* pt.c (pph_out_tinst_level): New.
	(pph_dump_tinst_level): New.
	(pph_in_tinst_level): New.
	(pph_dump_pending_templates_list): New.
	(pph_out_pending_templates_list): New.
	(pph_in_pending_templates_list): New.
	(pph_out_spec_entry_slot): New.
	(pph_out_spec_entry_htab): New.
	(pph_dump_spec_entry_slot): New.
	(pph_dump_spec_entry_htab): New.
	(pph_in_spec_entry_htab): New.
	(pph_out_spec_entry_tables): New.
	(pph_in_spec_entry_tables): New.
	* parser.c (cp_debug_parser): Factor out printing of token list.
	(cp_debug_parser_tokens): New.

2011-07-18   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_out_binding_table): Remove parameter
	REF_P.  Update all users.
	* pph-streamer-out.c (pph_out_ld_min): Likewise.
	(pph_out_tree_vec): Likewise.
	(pph_out_qual_use_vec): Likewise.
	(pph_out_cxx_binding_1): Likewise.
	(pph_out_cxx_binding): Likewise.
	(pph_out_class_binding): Likewise.
	(pph_out_label_binding): Likewise.
	(pph_out_chained_tree): Likewise.
	(pph_out_chain_filtered): Likewise.
	(pph_out_binding_level): Likewise.
	(pph_out_tree_common): Likewise.
	(pph_out_c_language_function): Likewise.
	(pph_out_language_function): Likewise.
	(pph_out_ld_fn): Likewise.
	(pph_out_used_types_slot): Likewise.
	(pph_out_struct_function): Likewise.
	(pph_out_ld_ns): Likewise.
	(pph_out_ld_parm): Likewise.
	(pph_out_lang_specific): Likewise.
	(pph_out_lang_type_header): Likewise.
	(pph_out_tree_pair_vec): Likewise.
	(pph_out_sorted_fields_type): Likewise.
	(pph_out_lang_type_class): Likewise.
	(pph_out_lang_type_ptrmem): Likewise.
	(pph_out_lang_type): Likewise.
	(pph_out_scope_chain): Likewise.
	(pph_out_symtab_marker): Likewise.
	(pph_out_symtab): Likewise.
	(pph_write_file_contents): Likewise.
	(pph_out_tree_header): Likewise.
	(pph_out_function_decl): Likewise.
	(pph_write_tree): Mark REF_P unused.
	* pph-streamer.c (enum pph_trace_type): Remove value
	PPH_TRACE_REF.  Update all users.
	* pph-streamer.h (pph_trace_tree): Remove last argument.
	Update all users.
	(pph_out_tree): Remove parameter REF_P.  Update all users.
	(pph_out_tree_array): Likewise.
	(pph_out_tree_or_ref_1): Likewise.
	(pph_out_tree_or_ref): Likewise.
	(pph_out_tree_VEC): Likewise.
	(pph_out_chain): Likewise.
	* pph-streamer-in.c (pph_in_tree_pair_vec): Update comment.
	(pph_in_sorted_fields_type): Likewise.
	(pph_in_lang_type_class): Likewise.

2011-07-18   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_struct_function): Revert previous
	change.  Do not allow shared struct functions.
	* pph-streamer-out.c (decls_to_register_t): New type.
	(decls_to_register): Change type to decls_to_register_t.
	Update all users.
	(pph_add_decl_to_register): Do not register the same DECL more
	than once.

2011-07-14   Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/decl.o): Add dependency on CXX_PPH_STREAMER_H.
	(cp/pph-streamer-out.o): Add dependency on CGRAPH_H.
        (cp/pph-streamer-in.o): Add dependency on toplev.h

	* cp-tree.h (cp_rest_of_decl_compilation): Declare.
	* call.c (set_up_extended_ref_temp): Call cp_rest_of_decl_compilation
        instead of rest_of_decl_compilation.
	* class.c (build_clone): Likewise.
	* decl2.c (finish_anon_union): Likewise.
	(maybe_emit_vtables): Likewise.
	(write_out_vars): Likewise.
	* method.c (implicitly_declare_fn): Likewise.
	* semantics.c (maybe_add_lambda_conv_op): Likewise.
	* decl.c (make_rtl_for_nonlocal_decl): Likewise.
	(cp_finish_decl): Likewise.
	(start_preparsed_function): Likewise.
	(cp_rest_of_decl_compilation): New.

	* pph-streamer-in.c: Include toplev.h
        (pph_in_language_function): Tidy.
	(pph_in_struct_function): Remove parameter DECL.
        Support reading shared struct functions.
        Read FN->DECL.
	(pph_register_decl_in_symtab): Remove.  Update all users.
	(pph_register_binding_in_symtab): Remove.  Update all users.
	(pph_in_symtab_marker): New.
	(pph_in_symtab): New.
	(pph_read_file_contents): Call it.
	(pph_in_function_decl): Do not call pph_in_struct_function.
	* pph-streamer-out.c: Include cgraph.h.
        (decls_to_register): New.
	(pph_out_chain_filtered): Remove argument REVERSE_P.  Update
        all users.
	(pph_out_struct_function): Write FN->DECL.
	(pph_out_symtab_marker): New.
	(pph_out_symtab): New.
	(pph_write_file_contents): Call it.
	(pph_out_function_decl): Do not call pph_out_struct_function.
	(pph_add_decl_to_register): New.
	* pph-streamer.h (enum pph_symtab_marker): New.
        (struct pph_stream): Remove field FNS_TO_EXPAND.  Update all
        users.
        (pph_add_decl_to_register): Declare.

2011-07-12   Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pushdecl_into_namespace): Replace references
	to struct cp_binding_level with cp_binding_level.
	(print_binding_level): Likewise.
	(print_namespace): Likewise.
	* pph-streamer-in.c (pph_in_qual_use_vec): Likewise.
	(pph_in_label_binding): Likewise.
	(pph_in_binding_level): Likewise.
	(pph_register_decl_in_symtab): Likewise.
	(pph_register_binding_in_symtab): Likewise.
	(pph_in_scope_chain): Likewise.
	* pph-streamer-out.c (pph_out_qual_use_vec): Likewise.
	(pph_out_chain_filtered): Likewise.
	(pph_out_binding_level): Likewise.
	* pph.c (pph_dump_tree_name): Likewise.
	(pph_dump_namespace): Likewise.

2011-07-12   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_register_decl_in_symtab): New.
	(pph_register_binding_in_symtab): Rename from
	pph_register_decls_in_symtab.  Update all users.
	Do not call nreverse on bl->names and bl->namespaces.
	Call pph_register_decl_in_symtab.
	(pph_read_file_contents): Register decls in
	FILE_STATIC_AGGREGATES.

2011-07-12  Gabriel Charette  <gchare@google.com>
	    Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_chained_tree): New.
	(pph_out_chain_filtered): Add REVERSE_P parameter.
	If REVERSE_P is set, write the list in reverse order.
	Update all users.
	(pph_out_binding_level): Write out lists bl->names,
	bl->namespaces, bl->usings and bl->using_directives in
	reverse.

2011-07-12  Gabriel Charette  <gchare@google.com>

       * pph-streamer-in.c (pph_add_bindings_to_namespace):
       NAMESPACE_LEVEL should never be null for a namespace, removed check.

2011-07-11   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_scope_chain): Replace VEC_iterate
	loops with FOR_EACH_VEC_ELT.
	(pph_read_file_contents): Likewise.
	* pph-streamer-out.c (pph_out_tree_vec): Likewise.
	(pph_out_qual_use_vec): Likewise.
	(pph_out_binding_level): Likewise.
	(pph_out_tree_pair_vec): Likewise.
	* pph-streamer.h (pph_out_tree_VEC): Likewise.

2011-07-11   Diego Novillo  <dnovillo@google.com>
	     Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (ALLOC_AND_REGISTER_ALTERNATE): Define.
	(pph_in_binding_level): Add argument TO_REGISTER.  Call
	ALLOC_AND_REGISTER_ALTERNATE if set.
	Update all users.
	(pph_register_decls_in_symtab): Call varpool_finalize_decl
	on all file-local symbols.
	(pph_in_scope_chain): Call pph_in_binding_level with
	scope_chain->bindings as the alternate pointer to
	register in the streaming cache.

2011-07-07   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_register_decls_in_symtab): Rename
	from pph_add_bindings_to_namespace.
	Do not call pushdecl_into_namespace for every symbol.  Just
	reset the scope for its identifier's namespace binding.
	(pph_in_scope_chain): Merge every field in struct
	cp_binding_level from the scope_chain->bindings coming from
	STREAM and the current scope_chain->bindings.

2011-07-06   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_scope_chain): Fix formatting.

2011-07-05  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_file_contents): Do not clobber
	unemitted_tinfo_decls and keyed_classes.  Append new elements
	from STREAM.

2011-07-05   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_add_bindings_to_namespace): Recurse into
	each namespace bindings, if needed.
	(pph_read_file_contents): Add static aggregates from STREAM into
	static_aggregates.
	* pph-streamer-out.c (pph_write_file_contents): Write
	static_aggregates.

2011-07-04  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_add_bindings_to_namespace):
	Rebuild the varpool for global variables coming in from the pph.

2011-06-30  Gabriel Charette  <gchare@google.com>

	* pph-streamer.h (struct pph_stream): Fix comment of data_in field.
	(pph_out_string_with_length): lto_output_string_with_length now handles
	NULL strings, call it directly.
	(pph_in_string): Fix comment.

2011-06-29   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_file_contents): Call
	expand_or_defer_fn on every function in stream->fns_to_expand.
	(pph_in_function_decl): If FNDECL has a body, add it to
	stream->fns_to_expand.
	(pph_read_tree): Tidy argument list.
	* pph-streamer.h (struct pph_stream): Add field fns_to_expand.

2011-06-29   Diego Novillo  <dnovillo@google.com>
	     Lawrence Crowl  <crowl@google.com>

	* pph-streamer-in.c (pph_in_lang_specific): Expect shared
	DECL_LANG_SPECIFIC fields.

2011-06-29   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_read_tree): Call
	append_to_statement_list_force instead of append_to_statement_list.

2011-06-28   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_ld_fn): Instantiate
	DECL_STRUCT_FUNCTION by calling allocate_struct_function.
	Remove assertion for stream->data_in.
	(pph_in_function_decl): Factor out of ...
	(pph_read_tree): ... here.
	* pph-streamer-out.c (pph_out_function_decl): Factor out of ...
	(pph_write_tree): ... here.

2011-06-28  Gabriel Charette  <gchare@google.com>

	* pph-streamer.c (pph_preload_common_nodes):
	Append DECL_CONTEXT of global_namespace to cache.

2011-06-28  Gabriel Charette  <gchare@google.com>

	* pph-streamer.c (pph_preload_common_nodes):
	Add cp_global_trees[] to cache.

2011-06-28  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_add_bindings_to_namespace): Reverse names and
	namespaces chains.

2011-06-27  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_get_type_from_index):
	Rename from pth_get_type_from_index. Update all users.
	(pph_in_number): Rename from pth_load_number.
	Update all users.
	(pph_in_token_value): Rename from pth_load_token_value. Change
	signature to 'pph_stream*, cp_token*' from 'cp_token*, pph_stream*'.
	Update all users.
	(pph_in_token): Rename from pth_load_token.
	Update all users.
	(pph_in_token_cache): Rename from pth_load_token_cache.
	Update all users.
	(pph_in_identifiers): Rename from pth_load_identifiers. Change
	signature to 'pph_stream*, cpp_idents_used*' from
	'cpp_idents_used*, pph_stream*'.
	from (cpp_idents_used*, pph_stream*).
	Update all users.
	* pph-streamer-out.c (pph_get_index_from_type):
	Rename from pth_get_index_from_type.
	Update all users.
	(pph_out_number): Rename from pth_write_number.
	Update all users.
	(pph_out_token_value): Rename from pth_save_token_value.
	Update all users.
	(pph_out_token): Rename from pth_save_token. Change signature to
	'pph_stream*, cp_token*' from 'cp_token*, pph_stream*'.
	Update all users.
	(pph_out_token_cache): Rename from pth_save_token_cache. Change
	signature to 'pph_stream*, cp_token_cache*'
	from 'cp_token_cache*, pph_stream*'.
	Update all users.
	(pph_out_identifiers): Rename from pth_save_identifiers. Change
	signature to 'pph_stream*, cpp_idents_used*' from
	'cpp_idents_used*, pph_stream*'.
	Update all users.

2011-06-27  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pth_get_type_from_index): Moved from pph.c.
	(pth_load_number): Moved from pph.c.
	(pth_load_token_value): Moved from pph.c.
	(pth_load_token): Moved from pph.c.
	(pth_load_token_cache): Moved from pph.c. Made static.
	* pph-streamer-out.c (pth_get_index_from_type): Moved from pph.c.
	(pth_write_number): Moved from pph.c.
	(pth_save_token_value): Moved from pph.c.
	(pth_save_token): Moved from pph.c.
	(pth_save_token_cache): Moved from pph.c. Made static.
	* pph-streamer.h (struct cp_token_cache): 
	Not declared in pph.c, but in parser.h, removed.
	(pth_save_token_cache): Now static, removed.
	(pth_load_token_cache): Now static, removed.

2011-06-27  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_read_tree):
	Stream in DECL_CHAIN of VAR_DECL.
	Stream in DECL_CHAIN of FUNCTION_DECL.
	* pph-streamer-out.c (pph_write_tree):
	Stream out DECL_CHAIN of VAR_DECL.
	Stream out DECL_CHAIN of FUNCTION_DECL.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* name-lookup.h (cp_binding_level): Removed unused
	member names_size. Update all users.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_add_names_to_namespace): Replaced by
	pph_add_bindings_to_namespace.
	(pph_add_bindings_to_namespace): New.
	(pph_in_scope_chain): New.
	(pph_read_file_contents): Remove unused variable file_ns.
	(pph_read_file_contents): Call pph_in_scope_chain.
	* pph-streamer-out.c (pph_out_scope_chain): New.
	(pph_write_file_contents): Call pph_out_scope_chain.
	* pph-streamer.c (pph_preload_common_nodes):
	Call lto_streamer_cache_append.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-out.c (pph_out_lang_specific): Removed extra space.
	(pph_write_tree): Removed extra space.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_in_tree_vec): Make static.
	(pph_add_names_to_namespace): Moved from pph.c.
	(wrap_macro_def): Moved from pph.c.
	(report_validation_error): Moved from pph.c.
	(pth_load_identifiers): Moved from pph.c.
	(pph_read_file_contents): Moved from pph.c.
	(pph_read_file): Moved from pph.c
	* pph-streamer-out.c (pph_out_tree_vec): Make static.
	(pph_out_chain_filtered): Make static.
	(pth_save_identifiers): Moved from pph.c.
	(pph_write_file_contents): Moved from pph.c.
	(pph_write_file): Moved from pph.c.
	* pph-streamer.h (pph_out_tree_vec): Now static, removed.
	(pph_out_chain_filtered): Now static, removed.
	(pph_write_file): Now public, added.
	(pph_in_tree_vec): Now static, removed.
	(pph_read_file): Now public, added.
	* pph.h (pph_dump_namespace): Declare.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_start_record): Initialize
	cache_ix in all paths.

2011-06-22  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_in_start_record): 
	Rename from pph_start_record. Update all users.
	* pph-streamer-out.c (pph_out_start_record): 
	Rename from pph_start_record. Update all users.

2011-06-16  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_in_cxx_binding): Fix streaming logic.
	* pph-streamer-out.c (pph_out_cxx_binding): Fix streaming logic.

2011-06-14  Lawrence Crowl <crowl@google.com>

	* pph-streamer-out.c (pph_out_struct_function): New.
	(pph_out_used_types_slot): New for pph_out_struct_function.
	(struct pph_tree_info): New for pph_out_struct_function.
	(pph_write_tree): Save DECL_STRUCT_FUNCTION of FUNCTION_DECL with
	pph_out_struct_function.
	* pph-streamer-in.c (pph_in_struct_function): New.
	(pph_read_tree): Load DECL_STRUCT_FUNCTION of FUNCTION_DECL with
	pph_in_struct_function.

2011-06-14  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_in_binding_level): Fix read
	of shadowed_labels.
	Remove unused variable sl.

2011-06-13   Diego Novillo  <dnovillo@google.com>

	* class.c (sorted_fields_type_new): Set field LEN in the
	newly allocated vector.
	(finish_struct_1): Remove setting of FIELD_VEC->LEN.

2011-06-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_in_sorted_fields_type): Tidy.

2011-06-13   Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_out_class_binding): Tidy.

2011-06-10  Diego Novillo  <dnovillo@google.com>

	* lang-specs.h (@c++-header): Disable PCH if -fpph-gen is given.
	Emit --output-pph if -fpph-gen is used.

2011-06-09  Gabriel Charette  <gchare@google.com>

	* pph-streamer-out.c (pph_out_tree_header): Rename from
	  pph_output_tree_header. Update all users.

2011-06-08   Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_lexer_dump_tokens): If START_TOKEN is NULL,
	set it to the start of the token buffer.
	If BUFFER is NULL, do nothing.
	(cp_debug_parser): Increase token window size.

2011-06-08  Diego Novillo  <dnovillo@google.com>

	Fix spurious differences with trunk.

	* call.c: Do not include pph.h.
	(implicit_conversion): Remove unnecessary braces.
	(build_new_op_1): Likewise.
	* cp-gimplify.c (cp_genericize): Remove FIXME comment.
	* cp-lang.c: Do not include pph.h.
	* decl.c (duplicate_decls): Rename from duplicate_decls_internal.
	(xref_tag_1): Remove FIXME comment.
	* Make-lang.in (cp/cp-lang.o): Remove $(CXX_PPH_H) dependency.
	(cp/decl.o): Remove $(CXX_PPH_H) and langhooks.h dependencies.
	(cp/pt.o): Remove $(CXX_PPH_H) dependency.
	* pt.c: Do not include pph.h.
	* rtti.c (create_pseudo_type_info): Remove setting of
	DECL_ARTIFICIAL.

2011-06-06  Gabriel Charette  <gchare@google.com>

	* pph.c (pth_stats): Remove field. Update all users.
	(pth_get_state): Remove. Update all users.
	(pth_debug_identifiers): Likewise.
	(pth_debug_token_hunks): Likewise.
	(pth_debug_state): Likewise.
	(pth_image_lookup): Likewise.
	(pth_init): Likewise.
	(pth_print_stats): Likewise.
	(pth_finish): Likewise.
	* pph.h (struct pth_include): Likewise.
	(struct pth_image): Likewise.
	(struct pth_state): Likewise.
	(PTH_STATS_INCR): Likewise.

2011-06-05  Lawrence Crowl <crowl@google.com>

	* pph-streamer.c (pph_trace): Clean up trace formatting.
	* pph-streamer-in.c (pph_in_tree_common): New for TS_COMMON chain.
	(pph_read_tree): Call pph_in_tree_common in existing readers for trees.
	Implement readers for C++-specific trees that need pph_in_tree_common.
	* pph-streamer-out.c (pph_out_tree_common): New for TS_COMMON chain.
	(pph_write_tree): Call pph_out_tree_common in existing writers for
	trees.  Implement readers for C++-specific trees that need
	pph_out_tree_common.

2011-06-03  Gabriel Charette  <gchare@google.com>

	* pph.h (struct pph_stats_d): Remove.  Update all users.
	(struct pph_decl_deps_d): Likewise.
	(PPH_POP_TIMEVAR_AND_RETURN): Likewise.
	(pph_start_exposed): Likewise.
	(pph_stop_exposed): Likewise.
	(pph_catch_tree): Likewise.
	(pph_uncatch_tree): Likewise.
	(pph_catch_name_lookup): Likewise.
	* pph.c (pph_print_trees_tokens): Likewise.
	(pph_tree_catcher): Likewise.
	(pph_name_lookups): Likewise.
	(pph_nl_token_map): Likewise.
	(pph_decl_head_token_cache): Likewise.
	(pph_decl_body_token_cache): Likewise.

2011-06-01  Lawrence Crowl <crowl@google.com>

	* pph-streamer-in.c (pph_in_ld_fn): Stream in struct
	lang_decl_min because it is a member of struct lang_decl_fn.
	* pph-streamer-out.c (pph_in_ld_fn): Stream out struct
	lang_decl_min because it is a member of struct lang_decl_fn.

2011-05-31  Gabriel Charette  <gchare@google.com>

	* pph-streamer-in.c (pph_unpack_value_fields): Rename
	from pph_stream_unpack_value_fields.
	Update all users.
	(pph_init_read): Rename from pph_stream_init_read.
	Update all users.
	(pph_in_shared_data): Rename from pph_stream_read_shared_data.
	Update all users.
	(pph_register_shared_data): Rename from pph_stream_register_shared_data.
	Update all users.
	(pph_in_ld_base): Rename from pph_stream_read_ld_base.
	Update all users.
	(pph_in_ld_min): Rename from pph_stream_read_ld_min.
	Update all users.
	(pph_in_tree_vec): Rename from pph_stream_read_tree_vec.
	Update all users.
	(pph_in_qual_use_vec): Rename from pph_stream_read_qual_use_vec.
	Update all users.
	(pph_in_cxx_binding_1): Rename from pph_stream_read_cxx_binding_1.
	Update all users.
	(pph_in_cxx_binding): Rename from pph_stream_read_cxx_binding.
	Update all users.
	(pph_in_class_binding): Rename from pph_stream_read_class_binding.
	Update all users.
	(pph_in_label_binding): Rename from pph_stream_read_label_binding.
	Update all users.
	(pph_in_binding_level): Rename from pph_stream_read_binding_level.
	Update all users.
	(pph_in_c_language_function): Rename from
	pph_stream_read_c_language_function.
	Update all users.
	(pph_in_language_function): Rename from
	pph_stream_read_language_function.
	Update all users.
	(pph_in_ld_fn): Rename from pph_stream_read_ld_fn.
	Update all users.
	(pph_in_ld_ns): Rename from pph_stream_read_ld_ns.
	Update all users.
	(pph_in_ld_parm): Remame from pph_stream_read_ld_parm.
	Update all users.
	(pph_in_lang_specific): Rename from pph_stream_read_lang_specific.
	Update all users.
	(pph_alloc_tree): Rename from pph_stream_alloc_tree.
	Update all users.
	(pph_in_lang_type_header): Rename from pph_stream_read_lang_type_header.
	Update all users.
	(pph_in_tree_pair_vec): Rename from pph_stream_read_tree_pair_vec.
	Update all users.
	(pph_in_sorted_fields_type): Rename from
	pph_stream_read_sorted_fields_type.
	Update all users.
	(pph_in_lang_type_class): Rename from pph_stream_read_lang_type_class.
	Update all users.
	(pph_in_lang_type_ptrmem): Rename from pph_stream_read_lang_type_ptrmem.
	Update all users.
	(pph_in_lang_type): Rename from pph_stream_read_lang_type.
	Update all users.
	(pph_read_tree): Rename from pph_stream_read_tree.
	Update all users.
	* pph-streamer.c (pph_hooks_init): Rename from pph_stream_hooks_init.
	Update all users.
	(pph_trace): Rename from pph_stream_trace.
	Update all users.
	(pph_trace_tree): Rename from pph_stream_trace_tree.
	Update all users.
	(pph_trace_uint): Rename from pph_stream_trace_uint.
	Update all users.
	(pph_trace_bytes): Rename from pph_stream_trace_bytes.
	Update all users.
	(pph_trace_string): Rename from pph_stream_trace_string.
	Update all users.
	(pph_trace_string_with_length): Rename from
	pph_stream_trace_string_with_length.
	Update all users.
	(pph_trace_chain): Rename from pph_stream_trace_chain.
	Update all users.
	(pph_trace_bitpack): Rename from pph_stream_trace_bitpack.
	Update all users.
	(pph_cache_insert_at): Rename from pph_stream_cache_insert_at.
	Update all users.
	(pph_cache_add): Rename from pph_stream_cache_add.
	Update all users.
	(pph_cache_get): Rename from pph_stream_cache_get.
	Update all users.
	* pph-streamer.h (pph_pickle_cache): Rename from
	pph_stream_pickle_cache.
	Update all users.
	(pph_out_tree): Rename from pph_output_tree.
	Update all users.
	(pph_out_tree_array): Rename from pph_output_tree_array.
	Update all users.
	(pph_out_tree_or_ref_1): Rename from pph_output_tree_or_ref_1.
	Update all users.
	(pph_out_tree_or_ref): Rename from pph_output_tree_or_ref.
	Update all users.
	(pph_out_uint): Rename from pph_output_uint.
	Update all users.
	(pph_out_uchar): Rename from pph_output_uchar.
	Update all users.
	(pph_out_bytes): Rename from pph_output_bytes.
	Update all users.
	(pph_out_string): Rename from pph_output_string.
	Update all users.
	(pph_out_string_with_length): Rename from pph_output_string_with_length.
	Update all users.
	(pph_out_tree_VEC): Rename from pph_output_tree_VEC.
	Update all users.
	(pph_out_chain): Rename from pph_output_chain.
	Update all users.
	(pph_out_bitpack): Rename from pph_output_bitpack.
	Update all users.
	(pph_in_uint): Rename from pph_input_uint.
	Update all users.
	(pph_in_uchar): Rename from pph_input_uchar.
	Update all users.
	(pph_in_bytes): Rename from pph_input_bytes.
	Update all users.
	(pph_in_string): Rename from pph_input_string.
	Update all users.
	(pph_in_tree): Rename from pph_input_tree.
	Update all users.
	(pph_in_tree_array): Rename from pph_input_tree_array.
	Update all users.
	(pph_in_tree_VEC): Rename from pph_input_tree_VEC.
	Update all users.
	(pph_in_chain): Rename from pph_input_chain.
	Update all users.
	(pph_in_bitpack): Rename from pph_input_bitpack.
	Update all users.
	* pph-streamer-out.c (pph_pack_value_fields): Rename from
	pph_stream_pack_value_fields.
	Update all users.
	(pph_init_write): Rename from pph_stream_init_write.
	Update all users.
	(pph_begin_section): Rename from pph_stream_begin_section.
	Update all users.
	(pph_out): Rename from pph_stream_write.
	Update all users.
	(pph_end_section): Rename from pph_stream_end_section.
	Update all users.
	(pph_out_header): Rename from pph_stream_write_head.
	Update all users.
	(pph_out_body): Rename from pph_stream_write_body.
	Update all users.
	(pph_flush_buffers): Rename from pph_stream_flush_buffers.
	Update all users.
	(pph_out_ld_base): Rename from pph_stream_write_ld_base.
	Update all users.
	(pph_out_ld_min): Rename from pph_stream_write_ld_min.
	Update all users.
	(pph_out_tree_vec): Rename from pph_stream_write_tree_vec.
	Update all users.
	(pph_out_qual_use_vec): Rename from pph_stream_write_qual_use_vec.
	Update all users.
	(pph_out_cxx_binding_1): Rename from pph_stream_write_cxx_binding_1.
	Update all users.
	(pph_out_cxx_binding): Rename from pph_stream_write_cxx_binding.
	Update all users.
	(pph_out_class_binding): Rename from pph_stream_write_class_binding.
	Update all users.
	(pph_out_label_binding): Rename from pph_stream_write_label_binding.
	Update all users.
	(pph_out_chain_filtered): Rename from pph_output_chain_filtered.
	Update all users.
	(pph_out_binding_level): Rename from pph_stream_write_binding_level.
	Update all users.
	(pph_out_c_language_function): Rename from
	pph_stream_write_c_language_function.
	Update all users.
	(pph_out_language_function): Rename from
	pph_stream_write_language_function.
	Update all users.
	(pph_out_ld_fn): Rename from pph_stream_write_ld_fn.
	Update all users.
	(pph_out_ld_ns): Rename from pph_stream_write_ld_ns.
	Update all users.
	(pph_out_ld_parm): Rename from pph_stream_write_ld_parm.
	Update all users.
	(pph_out_lang_specific): Rename from pph_stream_write_lang_specific.
	Update all users.
	(pph_out_lang_type_header): Rename from
	pph_stream_write_lang_type_header.
	Update all users.
	(pph_out_tree_pair_vec): Rename from pph_stream_write_tree_pair_vec.
	Update all users.
	(pph_out_sorted_fields_type): Rename from
	pph_stream_write_sorted_fields_type.
	Update all users.
	(pph_out_lang_type_class): Rename from pph_stream_write_lang_type_class.
	Update all users.
	(pph_out_lang_type_ptrmem): Rename from
	pph_stream_write_lang_type_ptrmem.
	Update all users.
	(pph_out_lang_type): Rename from pph_stream_write_lang_type.
	Update all users.
	(pph_output_tree_header): Rename from pph_stream_output_tree_header.
	Update all users.
	(pph_write_tree): Rename from pph_stream_write_tree.
	* name-lookup.c (pph_out_binding_table): Rename from
	pph_stream_write_binding_table.
	Update all users.
	(pph_in_binding_table): Rename from pph_stream_read_binding_table.
	Update all users.

2011-05-30  Diego Novillo  <dnovillo@google.com>

	* cp-objcp-common.c (cp_common_init_ts): Fix assertions for
	EXPR_PACK_EXPANSION and TYPE_ARGUMENT_PACK.

2011-05-30  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_stream_read_cxx_binding_1): Call
	ALLOC_AND_REGISTER.
	(pph_stream_read_label_binding): Likewise.
	(pph_stream_read_class_binding): Likewise.
	Do not memcpy into cb->base.  Assign to it directly.
	(pph_stream_read_c_language_function): Call
	pph_stream_read_tree_vec instead of pph_input_tree.
	* pph-streamer-out.c (pph_stream_write_class_binding): Do not
	write &cb->base.  Write cb->base.
	(pph_stream_write_c_language_function): Call
	pph_stream_write_tree_vec instead of pph_output_tree_or_ref.

2011-05-27  Lawrence Crowl  <crowl@google.com>

	* cp-objcp-common.c (cp_tree_size): Remove case TREE_BINFO.

2011-05-27  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (enum pph_record_marker): Define.
	Replace all users of PPH_RECORD_START and PPH_RECORD_END to
	use the new enum type.
	* pph-streamer-in.c (pph_stream_read_shared_data): New.
	(pph_stream_register_shared_data): New.
	(ALLOC_AND_REGISTER): Define.
	(pph_start_record): Add argument CACHE_IX.  Update all users.
	(pph_stream_read_ld_base): Do not call pph_start_record.
	(pph_stream_read_ld_min): Likewise.
	(pph_stream_read_cxx_binding_1): Handle PPH_RECORD_SHARED values
	returned from pph_start_record.
	Call pph_stream_register_shared_data.
	(pph_stream_read_cxx_binding): Do not call pph_start_record.
	Handle NULL values returned from pph_stream_read_cxx_binding_1.
	(pph_stream_read_class_binding): Handle PPH_RECORD_SHARED
	values returned from pph_start_record.
	Call pph_stream_register_shared_data.
	(pph_stream_read_label_binding): Likewise.
	(pph_stream_read_binding_level): Likewise.
	(pph_stream_read_c_language_function): Likewise.
	(pph_stream_read_language_function): Likewise.
	(pph_stream_read_ld_fn): Do not call pph_start_record.
	(pph_stream_read_ld_ns): Likewise.
	(pph_stream_read_lang_type_header): Likewise.
	(pph_stream_read_lang_type_class): Likewise.
	(pph_stream_read_lang_type_ptrmem): Likewise.
	(pph_stream_read_lang_specific): Handle PPH_RECORD_SHARED
	values returned from pph_start_record.
	(pph_stream_read_lang_type_class): Likewise.
	(pph_stream_read_lang_type_ptrmem): Likewise.
	(pph_stream_read_lang_type): Likewise.
	(pph_stream_read_sorted_fields_type): Likewise.
	Call pph_stream_register_shared_data.
	(pph_stream_read_lang_type): Remove TYPE argument.
	Return a pointer to the newly materialized struct lang_type.
	Update all users.
	Support shared struct lang_type nodes.
	* pph-streamer-out.c (pph_start_record): Call pph_stream_cache_add.
	(pph_stream_write_ld_base): Do not call pph_start_record.
	(pph_stream_write_ld_min): Likewise.
	(pph_stream_write_cxx_binding): Likewise.
	Handle the case when CB is NULL.
	(pph_stream_write_ld_fn): Do not call pph_start_record.
	(pph_stream_write_ld_ns): Likewise.
	(pph_stream_write_ld_parm): Likewise.
	(pph_stream_write_lang_type_header): Likewise.
	(pph_stream_write_lang_type_ptrmem): Likewise.
	* pph-streamer.c (pph_stream_open): Initialize stream->cache.v and
	stream->cache.m.
	(pph_stream_close): Free stream->cache.v, stream->cache.m and stream.
	(pph_stream_cache_insert_at): New.
	(pph_stream_cache_add): New.
	(pph_stream_cache_get): New.
	* pph-streamer.h (pph_stream_pickle_cache): Define.
	(pph_stream): Add field 'cache'.
	(pph_stream_cache_insert_at): Declare.
	(pph_stream_cache_add): Declare.
	(pph_stream_cache_get): Declare.

2011-05-26  Lawrence Crowl  <crowl@google.com>

	* cp-objcp-common.c (cp_tree_size): Add case TREE_BINFO.
	* pph.c (pph_read_file): Also log closing of PPH files.
	* pph-streamer-in.c (pph_stream_read_tree):
	Organize the switch into tcc_* chunks.
	Move tcc_statement case STATEMENT_LIST down.
        Implement tcc_type cases for BOUND_TEMPLATE_TEMPLATE_PARM,
	DECLTYPE_TYPE, TEMPLATE_TEMPLATE_PARM, TEMPLATE_TYPE_PARM,
	TYPENAME_TYPE, and TYPEOF_TYPE.
	Implement tcc_exceptional case TEMPLATE_PARM_INDEX.
	Add tcc_declaration case TRANSLATION_UNIT_DECL to already handled list.
        Create a section for unimplemented cases as opposed to unrecognized
	cases.
	* pph-streamer-out.c (pph_stream_write_tree):
	Organize the switch into tcc_* chunks.
	Move tcc_statement case STATEMENT_LIST down.
	Implement tcc_type cases for BOUND_TEMPLATE_TEMPLATE_PARM,
        DECLTYPE_TYPE, TEMPLATE_TEMPLATE_PARM, TEMPLATE_TYPE_PARM,
	TYPENAME_TYPE, and TYPEOF_TYPE.
        Move tcc_statement case STATEMENT_LIST down.
	Implement tcc_exceptional case TEMPLATE_PARM_INDEX.
	Add tcc_declaration case TRANSLATION_UNIT_DECL to already handled list.
        Create a section for unimplemented cases as opposed to unrecognized
	cases.

2011-05-26  Lawrence Crowl  <crowl@google.com>

	* pph-streamer-in.c (pph_stream_read_tree): Move TEMPLATE_DECL case
	next to other DECLs.
	* pph-streamer-out.c (pph_stream_write_tree): Move TEMPLATE_DECL case
	next to other DECLs.
	(pph_output_chain_filtered):  Move to just before its use.

2011-05-25  Lawrence Crowl  <crowl@google.com>

	* pph-streamer-in.c (pph_stream_read_tree): Reformat for style.
	* pph-streamer-out.c (pph_stream_write_tree): Reformat for style.

2011-05-25  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-out.c (pph_stream_write_tree) <TEMPLATE_DECL>:
	Do not write DECL_MEMBER_TEMPLATE_P.

2011-05-24  Lawrence Crowl  <crowl@google.com>

	* pph-streamer-in.c (pph_stream_read_tree): Refactor
	from nested if statements to a switch statement.
	For TEMPLATE_DECL, also input DECL_MEMBER_TEMPLATE_P.
	Report unhandled trees when -fpph-untree.
	Add already completely handled trees as separate cases.
	(pph_stream_read_tree_vec_none): Remove.
	* pph-streamer-out.c (pph_stream_write_tree): Refactor
	from nested if statements to a switch statement.
	For TEMPLATE_DECL, also output DECL_MEMBER_TEMPLATE_P.
	Report unhandled trees when -fpph-untree.
	Add already completely handled trees as separate cases.
	(pph_stream_write_tree_vec_none): Remove.

2011-05-24  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_stream_read_tree): For IDENTIFIER_NODE,
	only read fields in struct lang_identifier.
	Remove FIXME pph markers.
	* pph-streamer-out.c (pph_stream_write_tree): For IDENTIFIER_NODE,
	only write fields in struct lang_identifier.
	Remove FIXME pph markers.

2011-05-20  Lawrence Crowl <crowl@google.com>

	* pph-streamer-in.c (pph_stream_read_qual_use_vec): Add.
	(pph_stream_read_tree_vec_none): Add.
	(pph_stream_read_tree): Add read of various C++ fields.
	* pph-streamer-out.c (pph_stream_write_qual_use_vec): Add.
	(pph_stream_write_tree_vec_none): Add.
	(pph_stream_write_tree): Add write of various C++ fields.

2011-05-06  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_stream_hooks_init): Set
	has_unique_integer_csts_p field to true.

2011-05-05  Lawrence Crowl <crowl@google.com>

        * pph.c (pph_write_file_contents): Save keyed_classes and
        unemitted_tinfo_decls.
        (pph_read_file_contents): Restore keyed_classes and
        unemitted_tinfo_decls.
	* pph-streamer.h (pph_stream_write_tree_vec): Make extern.
	(pph_stream_read_tree_vec): Make extern.
	(pph_output_tree_array): Archive for future need.
	(pph_output_tree_VEC): Archive for future need.
	(pph_input_tree_array): Archive for future need.
	(pph_input_tree_VEC): Archive for future need.
	* pph-streamer-in.c (pph_stream_read_tree): Make extern.
	(pph_stream_read_tree): Restore TYPE_BINFO.
	* pph-streamer-out.c (pph_stream_write_tree_vec): Make extern.
	(pph_stream_write_tree): Save TYPE_BINFO.
	* name-lookup.c (pushdecl_into_namespace): Add leading comment.

2011-05-04  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_get_common_nodes): New.
	(pph_stream_hooks_init): Set it in h->get_common_nodes.

2011-04-29  Lawrence Crowl <crowl@google.com>

	* pph-streamer-out.c (pph_stream_write_tree): Write DECL_INITIAL
	instead of PARM_DECL DECL_ARG_TYPE.
	* pph-streamer-in.c (pph_stream_read_tree): Read DECL_INITIAL
	instead of PARM_DECL DECL_ARG_TYPE.

2011-04-28  Lawrence Crowl <crowl@google.com>

        * pph-streamer-out.c (pph_stream_write_tree): Write PARM_DECL
        DECL_ARG_TYPE.
        * pph-streamer-in.c (pph_stream_read_tree): Read PARM_DECL
        DECL_ARG_TYPE.

2011-04-26  Lawrence Crowl <crowl@google.com>

	* cp-tree.h (pushdecl_into_namespace): Add.
	* name-lookup.c (pushdecl_into_namespace): Add.
	* pph.c: Add include of tree-dump.h.
	(pph_dump_tree_name): Add.
	(pph_dump_namespace): Add.
	(pph_write_file_contents): Call pph_dump_namespace when appropriate.
	(pph_read_file_contents): Call pph_dump_namespace when appropriate.
	(pph_add_names_to_namespace): Use pushdecl_into_namespace rather than
	pushdecl_with_scope.  Make associated changes.  Enable recursive call
	for nested namespace.
	* pph-streamer.c (pph_stream_trace): Reformat conditionals.

2011-04-26  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (pph_output_tree_or_ref_1): New.
	(pph_output_tree_lst): Remove.  Change all
	callers to call pph_output_tree_1 with a tracing level of 2.
	(pph_output_tree_aux): Remove.  Change all callers to call
	pph_output_tree_1 with a tracing level of 3.
	(pph_output_tree_or_ref): Call pph_output_tree_or_ref_1 with
	a tracing level of 2.

2011-04-26  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_stream_unpack_value_fields): Read
	TREE_LANG_FLAG_? fields.
	* pph-streamer-out.c (pph_stream_pack_value_fields): Write
	TREE_LANG_FLAG_? fields.

2011-04-26  Diego Novillo  <dnovillo@google.com>

	* cp-objcp-common.c (cp_common_init_ts): Call
	mark_ts_structures_for and tree_node_structure_for_code.
	Change calls to MARK_TS_* into assertions instead.

2011-04-18  Lawrence Crowl <crowl@google.com>

	* pph.c (pth_save_identifiers): Fix FIXME comment.
        (pph_add_names_to_namespace): Add contained namespaces to scope as
	well as regular symbols.
	* pph-streamer.c (enum pph_trace_type): Add a trace for refs.
        (pph_stream_trace): Add the ref printing.  Reduce bulk of trace
	messages.  Filter off uninteresting traces, primarily traces of null
	pointers.
	(pph_stream_trace_tree): Convert ref_p to trace value.
	* pph-streamer.h: Adjust flag_pph_tracer comparisons for better traces.
	(pph_stream_trace_tree): Add ref_p parameter.  Propogate such
	parameters at all call sites.
        (pph_output_tree_lst): New.  Like pph_output_tree, but for list and
	chain contexts.
	(pph_stream_write_tree): The callback is auxillary.
	(pph_output_chain_filtered): Call pph_output_tree_lst.

2011-04-14  Diego Novillo  <dnovillo@google.com>

	* pph.c (pph_read_file_contents): Re-instate call to
	pph_add_names_to_namespace.
	(pph_include_handler): Return false if the file has been
	read from an image.

2011-04-14  Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/name-lookup.o): Add dependency on
	CXX_PPH_STREAMER_H.
	* name-lookup.c: Include pph-streamer.h.
	(pph_stream_write_binding_table): New.
	* pph-streamer-out.c (pph_stream_write_lang_type_header): New.
	(pph_stream_write_tree_pair_vec): New.
	(pph_stream_write_sorted_fields_type): New.
	(pph_stream_write_lang_type_class): New.
	(pph_stream_write_lang_type_ptrmem): New.
	(pph_stream_write_lang_type): New.
	(pph_stream_write_tree): Call it for TYPE_P nodes.
	* pph-streamer.h (pph_stream_write_binding_table): Declare.

2011-04-14  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_stream_read_tree): Fix handling of
	TYPE_DECLs.
	* pph-streamer-out.c (pph_stream_write_tree): Likewise.

2011-04-13  Diego Novillo  <dnovillo@google.com>

	* name-lookup.c (pph_stream_write_binding_table): Handle
	NULL BT->CHAIN entries.
	(pph_stream_read_binding_table): New.
	* pph-streamer-in.c (pph_stream_read_lang_specific): Rename
	from pph_stream_read_lang_specific_data.  Update all users.
	(pph_stream_read_lang_type_header): New.
	(pph_stream_read_tree_pair_vec): New.
	(pph_stream_read_sorted_fields_type): New.
	(pph_stream_read_lang_type_class): New.
	(pph_stream_read_lang_type_ptrmem): New.
	(pph_stream_read_lang_type): New.
	(pph_stream_read_tree): Call it.
	* pph-streamer-out.c (pph_stream_write_lang_specific): Rename
	from pph_stream_write_lang_specific_data.  Update all users.
	Remove duplicate assertion for DECL_P.
	(pph_stream_write_lang_type_header): Call pph_start_record.
	Call pph_output_bitpack instead of lto_output_bitpack.
	(pph_stream_write_sorted_fields_type): Call pph_start_record.
	(pph_stream_write_lang_type_class): Call pph_output_bitpack 
	instead of lto_output_bitpack.
	Guard call to pph_stream_write_binding_table with a call to
	pph_start_record.
	(pph_stream_write_lang_type_ptrmem): Call pph_start_record.
	(pph_stream_write_lang_type): Call pph_start_record.
	* pph-streamer.h (pph_stream_read_binding_table): Declare.

2011-04-13  Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (sorted_fields_type_new): Declare.

2011-04-13  Diego Novillo  <dnovillo@google.com>

	* class.c (sorted_fields_type_new): Factor out of ...
	(finish_struct_1): ... here.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* pph.c (pph_read_file_contents): Do not try to re-instantiate
	the PPH image.
	(pph_include_handler): Do not skip header file after reading
	the PPH image.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_debug_print_flag): Remove superfluous test.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* pph.c (pph_add_names_to_namespace): New.
	(pph_read_file_contents): Call it.
	Call cpp_lt_replay.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* pph-streamer-in.c (pph_stream_unpack_value_fields): Unpack
	TYPE_LANG_FLAGS and DECL_LANG_FLAGS.
	(pph_stream_read_tree): Handle TYPE_DECL.
	* pph-streamer-out.c (pph_stream_pack_value_fields): Pack
	TYPE_LANG_FLAGS and DECL_LANG_FLAGS.
	(pph_stream_write_binding_level): Call pph_output_chain_filtered
	with a NO_BUILTINS filter for fields that have DECLs in them.
	(pph_stream_write_tree): Handle TYPE_DECL.
	(pph_output_chain_filtered): New.
	* pph-streamer.c (pph_stream_trace): Show the code of the tree
	if it is not NULL_TREE.
	* pph-streamer.h (enum chain_filter): Declare.
	(pph_output_chain_filtered): Declare.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* pph.c (pth_include_handler): Return true.
	(pph_include_handler): If the header file exists as a PPH
	image, return false.

2011-04-12  Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (print_namespace): Declare.
	* name-lookup.c (print_namespace): New.
	* parser.c (cp_debug_print_context_stack): Increment loop counter.

2011-04-11  Diego Novillo  <dnovillo@google.com>

	* parser.c (cp_lexer_dump_tokens): Add arguments START_TOKEN and
	CURR_TOKEN.
	Update all callers.
	Print tokens starting with START_TOKEN.
	Highlight CURR_TOKEN by enclosing it in [[ ]].
	(cp_debug_print_tree_if_set): New.
	(cp_debug_print_context): New.
	(cp_debug_print_context_stack): New.
	(cp_debug_print_flag): New.
	(cp_debug_print_unparsed_function): New.
	(cp_debug_print_unparsed_queues): New.
	(cp_debug_parser): New.
	* cp/parser.h (cp_debug_parser): Declare.

2011-04-08  Lawrence Crowl  <crowl@google.com>

        * pph.c (pth_finish): Simplify inconsistency reporting.
	* pph-streamer.h (pph_output_tree_aux): New.
	(pph_output_string): Ensure trace happens before write.
	(pph_output_chain): Likewise.
	(pph_output_string_with_length): Likewise.  Add trace for null case.
	* pph-streamer-out.c (pph_stream_write_tree): Call pph_output_tree_aux
	instead of pph_output_tree.

2011-04-06  Lawrence Crowl  <crowl@google.com>

        * pph.c (pth_dump_identifiers):  Split cpp_idents_used::max_length
	into max_ident_length and max_value_length.  Print used_by_directive
	and expanded_to_text attributes of macros.
	(pth_save_identifiers): Split cpp_idents_used::max_length into
	max_ident_length and max_value_length.  Filter out macro that are
	neither used_by_directive nor expanded_to_text, which requires
	precounting the number of entries remaining.  Save used_by_directive
	and expanded_to_text attributes of the macros.
	(pth_load_identifiers): Split cpp_idents_used::max_length into
	max_ident_length and max_value_length.  Restore used_by_directive and
	expanded_to_text attributes of the macros.
	(pph_read_file): Make failure to read a pph file a non-fatal error.

2011-04-05  Lawrence Crowl <crowl@google.com>

	* parser.c (cp_lexer_dump_tokens): Remove #ifdef ENABLE_CHECKING.
	(cp_lexer_debug_tokens): Likewise.

2011-04-04  Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (cxx_binding_make): Declare.
	* name-lookup.c (cxx_binding_make): Make extern.
	* parser.c (cp_token_cache): Make extern.
	* parser.h (cp_token_cache): Declare.
	* pph-streamer-in.c (pph_stream_unpack_value_fields): Move
	earlier in the file.
	(pph_stream_init_read): Call lto_reader_init.
	Associate STREAM with STREAM->DATA_IN.
	(pph_start_record): New.
	(pph_stream_read_ld_base): New.
	(pph_stream_read_ld_min): New.
	(pph_stream_read_tree_vec): New.
	(pph_stream_read_cxx_binding_1): New.
	(pph_stream_read_cxx_binding): New.
	(pph_stream_read_class_binding): New.
	(pph_stream_read_label_binding): New.
	(pph_stream_read_binding_level): New.
	(pph_stream_read_c_language_function): New.
	(pph_stream_read_language_function): New.
	(pph_stream_read_ld_fn): New.
	(pph_stream_read_ld_ns): New.
	(pph_stream_read_ld_parm): New.
	(pph_stream_read_lang_specific_data): New.
	(pph_stream_read_tree): Retrieve pph_stream instance from
	DATA_IN->SDATA.
	Mark IB argument as unused.
	Call pph_stream_read_lang_specific_data for DECLs that have
	lang_specific data.
	Replace calls to lto_input_sleb128 with pph_input_uint.
	(pph_stream_alloc_tree): New.
	* pph-streamer-out.c (pph_stream_init_write): Call
	lto_writer_init.
	Associate STREAM with OB.
	(pph_start_record): New.
	(pph_stream_write_ld_base): Change first argument to be a
	pph_stream.  Change all users.
	Call pph_start_record.
	Call pph_output_bitpack.
	(pph_stream_write_ld_min): Likewise.
	(pph_stream_write_tree_vec): Likewise.
	(pph_stream_write_cxx_binding_1): Likewise.
	(pph_stream_write_cxx_binding): Likewise.
	(pph_stream_write_class_binding): Likewise.
	(pph_stream_write_label_binding): Likewise.
	(pph_stream_write_binding_level): Likewise.
	(pph_stream_write_c_language_function): Likewise.
	(pph_stream_write_language_function): Likewise.
	(pph_stream_write_ld_fn): Likewise.
	(pph_stream_write_ld_ns): Likewise.
	(pph_stream_write_ld_parm): Likewise.
	(pph_stream_write_lang_specific_data): Likewise.
	(pph_stream_write_tree): Only call
	pph_stream_write_lang_specific_data for tree nodes that have
	DECL_LANG_SPECIFIC set.
	* pph-streamer.c (enum pph_trace_type): Add PPH_TRACE_CHAIN
	and PPH_TRACE_BITPACK.
	(pph_stream_trace): Add "chain" and "bitpack" to TYPE_S.
	Handle PPH_TRACE_CHAIN And PPH_TRACE_BITPACK.
	(pph_stream_trace_tree): Do not compute tree code size on
	NULL_TREE.
	(pph_stream_trace_chain): New.
	(pph_stream_trace_bitpack): New.
	(pph_stream_output_tree_header): New.
	(pph_stream_hooks_init): Add hooks for alloc_tree and
	output_tree_header.
	* pph-streamer.h (PPH_RECORD_START): Declare.
	(PPH_RECORD_END): Declare.
	(pph_stream_trace_chain): Declare.
	(pph_stream_trace_bitpack): Declare.
	(pth_load_token_cache): Declare.
	(pph_output_tree_or_ref): New.
	(pph_output_uchar): New.
	(pph_output_string_with_length): Do not trace the string
	twice.
	(pph_output_chain): New.
	(pph_output_bitpack): New.
	(pph_input_uchar): New.
	(pph_input_chain): New.
	(pph_input_bitpack): New.
	(pph_get_pph_stream): Remove.  Update all users.
	(pph_set_pph_stream): Remove.  Update all users.
	(pph_stream_output_tree_header): Declare.
	(pph_stream_alloc_tree): Declare.
	* pph.c (pth_load_token): Factor out of pth_load_hunk.
	(pth_load_token_cache): New.
	(pph_read_file_contents): Read global_namespace.

2011-03-30  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.h (pph_get_pph_stream): Rename from
	pph_get_ob_stream.  Update all users.
	(pph_set_pph_stream): Rename from pph_set_pph_stream.  Update
	all users.
	(pph_output_tree): Remove ATTRIBUTE_UNUSED.
	(pph_input_tree): Remove ATTRIBUTE_UNUSED.

2011-03-30  Diego Novillo  <dnovillo@google.com>

	* cp-tree.h (struct language_function): Add prefix 'x_' to
	fields returns_value, returns_null, returns_abnormally,
	in_function_try_handler, in_base_initializer.  Update all
	users.
	* pph-streamer.c (pph_stream_write_ld_base): New.
	(pph_stream_write_ld_min): New.
	(pph_stream_write_tree_vec): New.
	(pph_stream_write_cxx_binding_1): New.
	(pph_stream_write_cxx_binding): New.
	(pph_stream_write_class_binding): New.
	(pph_stream_write_label_binding): New.
	(pph_stream_write_binding_level): New.
	(pph_stream_write_c_language_function): New.
	(pph_stream_write_language_function): New.
	(pph_stream_write_ld_fn): New.
	(pph_stream_write_ld_ns): New.
	(pph_stream_write_ld_parm): New.
	(pph_stream_write_lang_specific_data): New.
	(pph_indexable_with_decls_p): New.
	(pph_stream_hooks_init): Initialize h->indexable_with_decls_p
	with pph_indexable_with_decls_p.
	(pph_stream_begin_section): Do not free BLOCK.
	* pph-streamer.h (pth_save_token_cache): Declare.
	(pph_get_ob_stream): New.
	(pph_set_ob_stream): New.
	* pph.c (pth_save_token_cache): New.
	(pph_print_macro_defs_before): Remove.
	(pph_print_macro_defs_after): Remove.
	(pph_write_namespace): Remove.
	(pph_write_format): Remove.
	(pph_write_print): Remove.
	(pph_write_dump): Remove.
	(pph_write_symbol): Remove.
	(declvisitor): Remove.
	(pph_write_namespace_1): Remove.
	(pph_write_namespace): Remove.
	(pph_write_file_contents): Rename from pph_write_file_object.
	Output global_namespace.
	(pph_write_file): Call it.
	(pph_write_file_summary): Remove.
	(pph_read_file_contents): Rename from pph_file_read_object.
	(pph_read_file): Rename from pph_file_read.

2011-03-28  Diego Novillo  <dnovillo@google.com>

	* pph.c (pph_write_format): Rename from write_pph_format.
	(pph_write_namespace): Rename from write_pph_namespace.
	(pph_write_print): Rename from write_pph_print.
	(pph_write_dump): Rename from write_pph_dump.
	(pph_write_symbol): Rename from write_pph_symbol.
	(pph_write_namespace): Rename from write_pph_namespace.
	(pph_write_namespace_1): Rename from write_pph_namespace_1.
	(pph_write_file_object): Rename from write_pph_file_object.
	(pph_write_file_summary): Rename from write_pph_file_summary.
	(pph_write_file_dump): Rename from write_pph_file_dump.
	(pph_write_file): Rename from write_pph_file.
	(pph_file_read_object): Rename from read_pph_file_object.
	(pph_file_read): Rename from read_pph_file.

2011-03-25  Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/pph-streamer.o): Add dependency on
	tree-iterator.h.
	* pph-streamer.c: Include tree-iterator.h
	(pph_stream_write_tree): Handle STATEMENT_LIST.
	(pph_stream_read_tree): Likewise.
	(pph_is_streamable): New.
	(pph_stream_pack_value_fields): New.
	(pph_stream_unpack_valude_fields): New.
	(pph_stream_hooks_init): Rename from pph_streamer_hooks_init.
	Fill in callbacks for name, is_streamable, pack_value_fields
	and unpack_value_fields;
	(pph_stream_open):

2011-03-25  Diego Novillo  <dnovillo@google.com>

	* cp/pph-streamer.c (pph_stream_init_write):

2011-03-25  Diego Novillo  <dnovillo@google.com>

	* pph-streamer.c (pph_stream_hooks_init): New.
	(pph_stream_open): Call it.

2011-03-23  Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/pph-streamer.o): Add dependencies on
	tree-pretty-print.h, CXX_PPH_H, TREE_PASS_H, version.h and
	cppbuiltin.h
	* pph-streamer.c: Include tree-pretty-print.h, pph.h,
	tree-pass.h, version.h and cppbuiltin.h.
	(pph_get_section_data): New.
	(pph_free_section_data): New.
	(pph_stream_init_read): Rename from pph_file_read.
	Initialize LTO streaming data structures.
	Read pph file in memory.
	(pph_stream_init_write): Factor out of ...
	(pph_stream_open): ... here.
	(pph_stream_write_header): New.
	(pph_stream_write_body): Factor out of ...
	(pph_stream_close): ... here.
	Call pph_stream_write_header.
	(enum pph_trace_type): Declare.
	(pph_stream_trace): New.
	(pph_stream_trace_tree): New.
	(pph_stream_trace_uint): New.
	(pph_stream_trace_bytes): New.
	(pph_stream_trace_string): New.
	(pph_stream_trace_string_with_length): New.
	* pph-streamer.h (PPH_NUM_SECTIONS): Define.
	(PPH_USE_FILE_IO): Remove.  Update all users.
	(pph_id_str): Define.
	(pph_file_header): Declare.
	(pph_stream): Add fields pph_sections, file_data and file_size.
	(pph_stream_open): Change second argument to const char *.
	Update all users.
	(pph_stream_trace_tree): Declare.
	(pph_stream_trace_uint): Declare.
	(pph_stream_trace_bytes): Declare.
	(pph_stream_trace_string): Declare.
	(pph_stream_trace_string_with_length): Declare.
	(pph_output_tree): Call pph_stream_trace_tree if flag_pph_tracer
	is enabled.
	(pph_input_tree): Likewise.
	(pph_output_uint): Call pph_stream_trace_uint if flag_pph_tracer
	is enabled.
	(pph_input_uint): Likewise.
	(pph_output_bytes): Call pph_stream_trace_bytes if flag_pph_tracer
	is enabled.
	(pph_input_bytes): Likewise.
	(pph_output_string): Call pph_stream_trace_string if flag_pph_tracer
	is enabled.
	(pph_input_string): Likewise.
	(pph_output_string_with_length): Call
	pph_stream_trace_string_with_length if flag_pph_tracer is
	enabled.
	* pph.c (pph_print_macro_defs_before): Call pph_output_string.
	(pph_print_macro_defs_after): Likewise.
	(pth_load_token_value): Do not free the read string.
	(pth_load_identifiers): Likewise.
	(pth_load_include): Likewise.
	(pth_load_image): Call pph_input_bytes to read the header.
	(write_pph_print): Call pph_output_tree.
	(write_pph_file_object): Remove fprintf() call.
	(pth_include_handler): Remove FIXME marker.
	(pph_include_handler): Tidy.

2011-03-09  Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (CXX_AND_OBJCXX_OBJS): Add cp/pph-streamer.o
	(CXX_PPH_STREAMER_H): New.
	(cp/pph.o): Add dependency on CXX_PPH_STREAMER_H.
	(cp/pph-streamer.o): New.
	* pph-streamer.c: New file.
	* pph-streamer.h: New file.
	* pph.c: Update Copyright line.
	Include pph-streamer.h
	(pth_file_for): Change FILE * argument with pph_streamer *.
	Update all callers.
	(pth_write_uint): Remove.
	(pth_write_bytes): Remove.
	(pth_write_string): Remove.
	(pth_write_number): Re-implement using pph_streamer and 
	pph_output_* calls.
	(pth_save_token_value): Likewise.
	(pth_save_token): Likewise.
	(pth_write_header): Likewise.
	(pph_print_macro_defs_before): Likewise.
	(pph_print_macro_defs_after): Likewise.
	(pth_save_identifiers): Likewise.
	(pth_save_hunk): Likewise.
	(pth_save_include): Likewise.
	(pth_save_image): Likewise.
	(pth_read_uint): Remove.
	(pth_read_bytes): Remove.
	(pth_read_string): Remove.
	(pth_read_string_alloc): Remove.
	(pth_load_number): Re-implement using pph_streamer and
	pph_input_* calls.
	(pth_load_token_value): Likewise.
	(pth_load_identifiers): Likewise.
	(pth_load_hunk): Likewise.
	(pth_load_include): Likewise.
	(pth_load_include): Likewise.
	(pth_load_image): Likewise.
	(pth_have_valid_image_for): Likewise.
	(write_pph_format): Likewise.
	(write_pph_namespace): Likewise.
	(write_pph_print): Likewise.
	(write_pph_dump): Likewise.
	(write_pph_symbol): Likewise.
	(declvisitor): Likewise.
	(write_pph_namespace_1): Likewise.
	(write_pph_file_object): Likewise.
	(write_pph_file_summary): Likewise.
	(write_pph_file_dump): Likewise.
	(read_pph_file_object): Likewise.
	* pph.h: Update file comment.

2011-03-04  Lawrence Crowl <crowl@google.com>

	* cp/pph.c (pph_print_macro_defs_before): New.
	* (pph_print_macro_defs_after): New.
	* (write_pph_format): New.
	* (write_pph_namespace): New.
	* (write_pph_print): New.
	* (write_pph_dump): New.
	* (write_pph_symbol): New.
	* (write_pph_namespace_1): New.
	* (write_pph_namespace): New.
	* (write_pph_file_object): New.
	* (write_pph_file_summary): New.
	* (write_pph_file_dump): New.
	* (write_pph_file): Write used macros instead of dummy contents.
	Renamed from write_pph_output.
	* (wrap_macro_def): New.
	* (report_validation_error): New.
	* (read_pph_file_object): New.
	* (read_pph_file): Read used macros instead of dummy contents.
	Verify the macro values.
	* (pph_include_handler): Do not read a PPH file a second time.
	* (PPH_ARTIFICIAL): Remove redundant condition.
	* (pph_init): Set up the preprocessor lookaside table.

2011-02-24  Lawrence Crowl <crowl@google.com>

        * cp/pph.c (pph_finish): Check for missing preprocessor guard
        for pre-parsed headers.

2011-02-15  Lawrence Crowl <crowl@google.com>

        * cp/pph.c (write_pph_output, read_pph_file,
        pph_include_handler): Add.
	(pph_start_exposed, pph_stop_exposed): Change debug level.
	(pph_init): Set callback for pph_include_handler.
	(pph_finish): Write PPH file.
        * cp/parser.c (cp_lexer_new_main): Duplicate PTH and PCH
        incompatibility for PPH.  Add call to pph_init only when PPH
        is being used.
	* (c_parse_file): Remove call to pph_init.

2011-01-27  Diego Novillo  <dnovillo@google.com>

	* Make-lang.in (cp/parser.o): Fix dependencies.
	* pph.c (pth_process_text_file): Do not try to start reading the file
	at an arbitrary offset.
	Remove OFFSET argument.  Update all users.
	(pth_image_to_lexer): Emit a fatal error if a hunk fails
	validation.
	(pth_lexer_to_image):
	(pth_enter_file):
	* pph.h	(struct cp_token_hunk): Remove fields text_offset and
	text_length.
	Update all users.
	(struct pth_image): Remove field hunk_text_offset.
	Update all users.

2011-01-24  Lawrence Crowl <crowl@google.com>

        Merge timevar patch.

	* decl.c: (push_local_name): Change TV_NAME_LOOKUP to start/stop.
	* (poplevel): Refactor POP_TIMEVAR_AND_RETURN to plain code.
	Change TV_NAME_LOOKUP to start/stop.
	* (define_label): Refactor timevar calls out to a wrapper function.
	Change TV_NAME_LOOKUP to start/stop.
	* (xref_tag): Likewise.
	* (lookup_label): Refactor timevar calls out to a wrapper function.
	Change TV_NAME_LOOKUP to start_cond/stop_cond.

	* pt.c: (instantiate_class_template): Refactor timevar calls out to a
	wrapper function.  Add push/pop of new TV_INSTANTIATE_TEMPLATE.
	* (instantiate_template): Refactor timevar calls out to a wrapper
	function.  Add push/pop of new TV_INSTANTIATE_TEMPLATE.
	* (lookup_template_class): Refactor timevar calls out to a wrapper
	function.  Change TV_NAME_LOOKUP to start_cond/stop_cond.
	* (instantiate_decl): Change TV_PARSE to TV_PARSE_GLOBAL.

	* name-lookup.c: (store_bindings): Change TV_NAME_LOOKUP to start/stop.
	* (poplevel_class): Change TV_NAME_LOOKUP to start_cond/stop_cond.
	* (push_namespace): Likewise.
	* (pop_nested_namespace): Likewise.
	* (pushdecl_namespace_level): Likewise.
	* (store_class_bindings): Likewise.
	* (push_to_top_level): Likewise.
	* (identifier_type_value): Refactor timevar calls out to a wrapper
	function.  Change TV_NAME_LOOKUP to start/stop.
	* (find_binding): Likewise.
	* (push_using_decl): Likewise.
	* (lookup_arg_dependent): Likewise.
	* (push_using_directive): Likewise.
	* (qualified_lookup_using_namespace): Refactor POP_TIMEVAR_AND_RETURN
	to plain code.  Change TV_NAME_LOOKUP to start/stop.
	* (lookup_type_current_level): Likewise.  Refactor inner return to
	break.
	* (pushdecl_class_level): Refactor POP_TIMEVAR_AND_RETURN to plain
	code.  Change TV_NAME_LOOKUP to start_cond/stop_cond.
	* (pushdecl_top_level_1): Likewise.
	* (lookup_using_namespace): Likewise.
	* (pushdecl_with_scope): Refactor timevar calls out to a wrapper
	function.  Change TV_NAME_LOOKUP to start_cond/stop_cond.
	* (push_overloaded_decl): Likewise.
	* (push_class_level_binding): Likewise.
	* (namespace_binding): Likewise.
	* (set_namespace_binding): Likewise.
	* (supplement_binding): Likewise.
	* (unqualified_namespace_lookup): Likewise.
	* (lookup_name_real): Likewise.
	* (lookup_type_scope): Likewise.
	* (namespace_ancestor): Likewise.
	* (lookup_name_innermost_nonclass_level_1): Likewise.
	* (pushtag): Likewise.
	* (pop_from_top_level): Likewise.
	* (pushdecl_maybe_friend): Refactor timevar calls out to a wrapper
	function.  Change TV_NAME_LOOKUP to start_cond/stop_cond.  Wrap long
	lines.
	* (add_using_namespace): Refactor timevar calls out to a wrapper
	function.  Change TV_NAME_LOOKUP to start_cond/stop_cond.  Bypass
	wrapper on call to self.

	* decl2.c: (cp_write_global_declarations):  Add start/stop of
	new TV_PHASE_CP_DEFERRED, TV_PHASE_CGRAPH, TV_PHASE_CHECK_DBGINFO.
	Remove push/pop calls to TV_VARCONST.

	* parser.c: Add include of "timevar.h".
	* (cp_parser_explicit_instantiation): Add push/pop calls to new
	TV_INSTANTIATE_TEMPLATE.
	* (cp_parser_enum_specifier): Add push/pop calls to new TV_PARSE_ENUM.
	* (cp_parser_class_specifier): Add push/pop calls to new
	TV_PARSE_STRUCT.
	* (cp_parser_function_definition_from_specifiers_and_declarator): Add
	push/pop calls to new TV_PARSE_FUNC.
	* (cp_parser_late_parsing_for_member):  Add push/pop calls to
	new TV_PARSE_INMETH.

	* call.c: Add include of "timevar.h".
	* (perform_overload_resolution): Add push/pop calls to new
	TV_RESOLVE_OVERLOAD.

	* Make-lang.in: Add dependence of call.o and parser.o on $(TIMEVAR_H).

2010-12-16  Diego Novillo  <dnovillo@google.com>

	* pph.c (pph_find_exposed_for, pph_get_decl_exposure):
	Replace uses of DECL_INTEGRAL_CONSTANT_VAR_P with
	decl_constant_var_p.

2010-12-09  Lawrence Crowl  <crowl@google.com>

	* pph.c (pth_lexer_to_image): Remove call to cpp_lt_statistics.
	This call is now handled in libcpp.
	(cpp_lt_order): New constant for lookaside table size.
	Table reduced from 32768 slots to 512 slots.
	(pth_init): Use above constant in call to cpp_lt_create.

2010-12-02  Diego Novillo  <dnovillo@google.com>

	* pph.c: New file.
	* pph.h: New file.
	* parser.h: New file.
	* decl.c: Include pph.h.
	* cp/Make-lang.in (CXX_AND_OBJCXX_OBJS): Add cp/pph.o.
	(CXX_PARSER_H): Define.
	(CXX_PPH_H): Define.
	(cp/cp-lang.o): Add dependency on CXX_PARSER_H and
	CXX_PPH_H.
	(cp/parser.o): Likewise.
	(cp/decl.o): Add dependency on CXX_PPH_H.
	(cp/call.o): Likewise.
	(cp/pt.o): Likewise.
	(cp/name-lookup.o): Likewise.
	(cp/pph.o): New.
	* cp/cp-lang.c: Include parser.h and pph.h.
	* cp/pt.c: Include pph.h.
	* cp/parser.c: Remove inclusion of timevar.h,
	pointer-set.h, fixed-value.h, cpplib.h, line-map.h,
	md5.h, hashtab.h, tree-pass.h and tree-inline.h.
	Include parser.h and pph.h
	(struct tree_check): Move to parser.h.
	(struct cp_token): Likewise.
	(struct cp_lexer): Likewise.
	(struct cp_token_cache): Likewise.
	(struct cp_token_ident_d): Likewise.
	(CPP_KEYWORD): Likewise.
	(CPP_TEMPLATE_ID): Likewise.
	(CPP_NESTED_NAME_SPECIFIER): Likewise.
	(N_CP_TTYPES): Likewise.
	(enum cp_parser_status_kind): Likewise.
	(struct cp_parser_context): Likewise.
	(struct cp_default_arg_entry_d): Likewise.
	(struct cp_unparsed_functions_entry_d): Likewise.
	(struct cp_parser): Likewise.
	(struct cp_token_hunk): Move to pph.h.
	(DIGEST_LEN): Likewise.
	(struct pth_image): Likewise.
	(pth_image_ptr): Likewise.
	(struct pth_include): Likewise.
	(pth_include_ptr): Likewise.
	(struct pth_state): Likewise.
	(struct pth_stats_d): Likewise.
	(PTH_STATS_INCR): Likewise.
	(struct pph_stats_d): Likewise.
	(PPH_STATS_INCR): Likewise.
	(pth_stats): Make extern.
	(pph_stats): Likewise.
	(cp_lexer_dump_tokens): Likewise.
	(cp_lexer_debug_tokens): Likewise.
	(cp_lexer_token_position): Likewise.
	(cp_lexer_get_tokens): Likewise.
	(the_parser): Likewise.
	(pph_decl_head_token_cache): Move to pph.c
	(pph_decl_body_token_cache): Likewise.
	(struct pph_decl_deps_d): Likewise.
	(pph_decl_deps): Likewise.
	(pph_tree_catcher): Likewise.
	(pph_name_lookups): Likewise.
	(pph_name_lookups_set): Likewise.
	(pph_nl_token_map): Likewise.
	(pph_logfile): Likewise.
	(pph_print_tokens): Likewise.
	(pathnames_equal_p): Likewise.
	(pph_debug_location): Likewise.
	(pph_debug_loc_of_tree): Likewise.
	(pth_image_dir_hash): Likewise.
	(pth_image_dir_eq): Likewise.
	(pth_global_state): Likewise.
	(pth_get_state): Likewise.
	(pth_id_str): Likewise.
	(pth_header_len): Likewise.
	(PTH_EXTENSION): Likewise.
	(pth_name_for): Likewise.
	(pth_file_for): Likewise.
	(pth_get_md5_digest): Likewise.
	(pth_get_index_from_type): Likewise.
	(pth_write_uint): Likewise.
	(pth_write_sizet): Likewise.
	(pth_write_bytes): Likewise.
	(pth_write_string): Likewise.
	(pth_write_number): Likewise.
	(pth_save_token_value): Likewise.
	(pth_save_token): Likewise.
	(pth_write_header): Likewise.
	(pth_dump_identifiers): Likewise.
	(pth_debug_identifiers): Likewise.
	(pth_dump_hunk): Likewise.
	(pth_debug_hunk): Likewise.
	(pth_dump_include): Likewise.
	(pth_debug_include): Likewise.
	(pth_dump_token_hunks_1): Likewise.
	(pth_dump_token_hunks): Likewise.
	(pth_debug_token_hunks): Likewise.
	(pth_dump_image): Likewise.
	(pth_debug_image): Likewise.
	(pth_show_image_stats): Likewise.
	(pth_dump_state): Likewise.
	(pth_debug_state): Likewise.
	(pth_save_identifiers): Likewise.
	(pth_save_hunk): Likewise.
	(pth_save_include): Likewise.
	(pth_save_image): Likewise.
	(pth_get_type_from_index): Likewise.
	(pth_read_uint): Likewise.
	(pth_read_sizet): Likewise.
	(pth_read_bytes): Likewise.
	(pth_read_string): Likewise.
	(pth_read_string_alloc): Likewise.
	(pth_load_number): Likewise.
	(pth_load_token_value): Likewise.
	(pth_load_identifiers): Likewise.
	(pth_load_hunk): Likewise.
	(pth_create_include): Likewise.
	(pth_load_include): Likewise.
	(pth_load_image): Likewise.
	(pth_have_valid_image_for): Likewise.
	(pth_new_image): Likewise.
	(pth_image_lookup): Likewise.
	(pth_append_hunk): Likewise.
	(pth_hunk_is_valid_p): Likewise.
	(pth_image_can_be_used): Likewise.
	(pth_get_dir_and_name): Likewise.
	(pth_process_text_file): Likewise.
	(pth_image_to_lexer): Likewise.
	(pth_lexer_to_image): Likewise.
	(pth_get_file_transition): Likewise.
	(pth_leave_file): Likewise.
	(pth_enter_file): Likewise.
	(pth_file_change): Likewise.
	(pth_include_handler): Likewise.
	(pth_init): Likewise.
	(pth_print_stats): Likewise.
	(pth_finish): Likewise.
	(pph_log_exposed): Likewise.
	(pph_allocate_catcher_memory): Likewise.
	(pph_free_catcher_memory): Likewise.
	(pph_start_exposed): Likewise.
	(pph_lookup_head_token_cache_for): Likewise.
	(pph_lookup_body_token_cache_for): Likewise.
	(pph_set_head_token_cache_for): Likewise.
	(pph_set_body_token_cache_for): Likewise.
	(pph_copy_decls_into_cache): Likewise.
	(pph_copy_decls_outof_cache): Likewise.
	(pph_stop_exposed): Likewise.
	(pph_debug_tree): Likewise.
	(pph_debug_type): Likewise.
	(pph_tree_caught_p): Likewise.
	(pph_catch_head_tokens_for): Likewise.
	(pph_catch_body_tokens_for): Likewise.
	(pph_lookup_dependencies_for): Likewise.
	(pph_set_dependencies_for): Likewise.
	(is_namespace): Likewise.
	(PPH_ARTIFICIAL): Likewise.
	(pph_null_exposed): Likewise.
	(pph_live_exposed): Likewise.
	(pph_find_exposed_for): Likewise.
	(pph_catch_dependencies_for): Likewise.
	(pph_catch_tree): Likewise.
	(pph_uncatch_tree): Likewise.
	(pph_locate_name_lookups_in): Likewise.
	(pph_print_copy_tokens): Likewise.
	(pph_print_token_range): Likewise.
	(pph_print_dependence): Likewise.
	(pph_print_depend_template): Likewise.
	(pph_print_depend_decl): Likewise.
	(pph_print_depend_type): Likewise.
	(pph_print_depend_type_type): Likewise.
	(pph_print_depend_func_type): Likewise.
	(pph_print_depend_var_type): Likewise.
	(pph_get_decl_exposure): Likewise.
	(pph_print_dependences): Likewise.
	(pph_print_declaration_head): Likewise.
	(pph_print_declaration_body): Likewise.
	(pph_find_special_methods): Likewise.
	(pph_implicit_class_cost): Likewise.
	(pph_print_declaration): Likewise.
	(pph_print_declarations): Likewise.
	(pph_print_trees_tokens): Likewise.
	(pph_catch_name_lookup): Likewise.
	(pph_print_stats): Likewise.
	(pph_init): Likewise.
	(pph_finish): Likewise.
	* config-lang.in (gtfiles): Add cp/parser.h, cp/pph.h
	and cp/pph.c.
	* call.c: Include pph.h
	* cp-tree.h (PPH_POP_TIMEVAR_AND_RETURN): Move to
	pph.h
	(pph_catch_tree): Likewise.
	(pph_uncatch_tree): Likewise.
	(pph_catch_name_lookup): Likewise.
	* name-lookup.c: Include pph.h.

2010-11-02  Lawrence Crowl  <crowl@google.com>
	    Diego Novillo  <dnovillo@google.com>

	* decl.c: Include langhooks.h
	(duplicate_decls_internal): Rename from duplicate_decls
	(duplicate_decls): New wrapper around
	duplicate_decls_internal.
	* Make-lang.in (cp/decl.o): Add dependency on langhooks.h
	(cp/parser.o): Add dependency on pointer-set.h,
	fixed-value.h, MD5_H, HASTHTAB_H, tree-pass.h,
	TREE_INLINE_H and tree-pretty-print.h.
	(cp/name-lookup.o): Add dependency on tree-pretty-print.h
	* rtti.c (create_pseudo_type_info): Mark TYPE_NAME of
	PSEUDO_TYPE as artificial.
	* cp-gimplify.c	(cp_genericize): Add FIXME note.
	* parser.c: Include timevar.h, pointer-set.h,
	fixed-value.h, cpplib.h, line-map.h, md5.h, hashtab.h,
	tree-pass.h, tree-inline.h and tree-pretty-print.h.
	(struct cp_token): Add field purged_p.
	Adjust all users of CPP_PURGED.
	(eof_token): Adjust.
	(struct cp_lexer): Convert buffer into a VEC.
	Remove field buffer_length.
	Adjust all users.
	(cp_token_cache_ptr): New typedef.
	(struct cp_token_ident_d): Declare.
	(cp_token_ident): New typedef.
	(struct cp_token_hunk): Declare.
	(cp_token_hunk_ptr): New typedef.
	(DIGEST_LEN): Define.
	(struct pth_image): Define.
	(pth_image_ptr): New typedef.
	(struct pth_include): Define.
	(pth_include_ptr): New typedef.
	(struct pth_state): Declare.
	(struct pth_stats_d): Declare.
	(pth_stats): Declare.
	(PTH_STATS_INCR): Define.
	(struct pph_stats_d): Declare.
	(pph_stats): Declare.
	(PPH_STATS_INCR): Define.
	(pph_decl_head_token_cache): Declare.
	(pph_decl_body_token_cache): Declare.
	(struct pph_decl_deps_d): Declare.
	(pph_decl_deps): Declare.
	(pph_tree_catcher): Declare.
	(pph_name_lookups): Declare.
	(pph_name_lookups_set): Declare.
	(pph_nl_token_map): Declare.
	(pph_logfile): Declare.
	(pph_print_trees_tokens): Declare.
	(cp_lexer_print_token): Always declare.
	(CPP_PURGED): Remove.  Replace all uses with
	token->purged_p.
	(N_CP_TTYPES): Adjust.
	(cp_lexer_dump_tokens): Move earlier in the file.
	(cp_lexer_debug_tokens): New.
	(pathnames_equal_p): New.
	(pph_debug_location): New.
	(pph_debug_loc_of_tree): New.
	(pth_image_dir_hash): New.
	(pth_image_dir_eq): New.
	(pth_get_state): New.
	(pth_id_str): New.
	(pth_header_len): New.
	(PTH_EXTENSION): Define.
	(pth_name_for): New.
	(pth_file_for): New.
	(pth_get_md5_digest): New.
	(pth_get_index_from_type): New.
	(pth_write_uint): New.
	(pth_write_sizet): New.
	(pth_write_bytes): New.
	(pth_write_string): New.
	(pth_write_number): New.
	(pth_save_token_value): New.
	(pth_save_token): New.
	(pth_write_header): New.
	(pth_dump_identifiers): New.
	(pth_debug_identifiers): New.
	(pth_dump_hunk): New.
	(pth_debug_hunk): New.
	(pth_dump_include): New.
	(pth_debug_include): New.
	(pth_dump_token_hunks_1): New.
	(pth_dump_token_hunks): New.
	(pth_debug_token_hunks): New.
	(pth_dump_image): New.
	(pth_debug_image): New.
	(pth_show_image_stats): New.
	(pth_dump_state): New.
	(pth_debug_state): New.
	(pth_save_identifiers): New.
	(pth_save_hunk): New.
	(pth_save_include): New.
	(pth_save_image): New.
	(pth_get_type_from_index): New.
	(pth_read_uint): New.
	(pth_read_sizet): New.
	(pth_read_bytes): New.
	(pth_read_string): New.
	(pth_read_string_alloc): New.
	(pth_load_number): New.
	(pth_load_token_value): New.
	(pth_load_identifiers): New.
	(pth_load_hunk): New.
	(pth_create_include): New.
	(pth_load_include): New.
	(pth_load_image): New.
	(pth_have_valid_image_for): New.
	(pth_new_image): New.
	(pth_image_lookup): New.
	(pth_append_hunk): New.
	(pth_hunk_is_valid_p): New.
	(pth_image_can_be_used): New.
	(cp_lexer_finished_p): New.
	(cp_lexer_get_tokens): New.
	(pth_get_dir_and_name): New.
	(pth_process_text_file): New.
	(pth_image_to_lexer): New.
	(pth_lexer_to_image): New.
	(pth_get_file_transition): New.
	(pth_leave_file): New.
	(pth_enter_file): New.
	(pth_file_change): New.
	(pth_include_handler): New.
	(pth_init): New.
	(pth_print_stats): New.
	(pth_finish): New.
	(cp_lexer_alloc): New.
	(cp_lexer_new_main): Rewrite to support -fpth.
	(cp_lexer_get_preprocessor_token): Flag error if -fpth
	is used together with PCH.
	(cp_lexer_consume_token): Call PPH_STATS_INCR.
	(cp_lexer_print_token): Remove "PURGED" string.
	Show CPP_NUMBER tokens.
	Do not abort if token->type is outside of TOKEN_NAMES.
	(pph_log_exposed): New.
	(pph_allocate_catcher_memory): New.
	(pph_free_catcher_memory): New.
	(pph_start_exposed): New.
	(pph_lookup_head_token_cache_for): New.
	(pph_lookup_body_token_cache_for): New.
	(pph_set_head_token_cache_for): New.
	(pph_set_body_token_cache_for): New.
	(pph_copy_decls_into_cache): New.
	(pph_copy_decls_outof_cache): New.
	(pph_stop_exposed): New.
	(cp_parser_declaration): Call pph_start_exposed and
	pph_stop_exposed for several cases.
	(cp_parser_elaborated_type_specifier): Add tracing code
	for -fpph-debug.
	(cp_parser_class_specifier): Add FIXME notes.
	(cp_parser_lookup_name_1): Rename from cp_parser_lookup_name.
	(cp_parser_lookup_name): Call it.
	Call pph_catch_name_lookup with the result.
	(pph_debug_tree): New.
	(pph_debug_type): New.
	(pph_tree_caught_p): New.
	(pph_catch_head_tokens_for): New.
	(pph_catch_body_tokens_for): New.
	(pph_lookup_dependencies_for): New.
	(pph_set_dependencies_for): New.
	(is_namespace): New.
	(pph_null_exposed): New.
	(pph_live_exposed): New.
	(pph_find_exposed_for): New.
	(pph_catch_dependencies_for): New.
	(pph_catch_tree): New.
	(pph_uncatch_tree): New.
	(pph_locate_name_lookups_in): New.
	(pph_print_copy_tokens): New.
	(pph_print_token_range): New.
	(pph_print_dependence): New.
	(pph_print_depend_template): New.
	(pph_print_depend_decl): New.
	(pph_print_depend_type): New.
	(pph_print_depend_type_type): New.
	(pph_print_depend_func_type): New.
	(pph_print_depend_var_type): New.
	(pph_get_decl_exposure): New.
	(pph_print_dependences): New.
	(pph_print_declaration_head): New.
	(pph_print_declaration_body): New.
	(pph_find_special_methods): New.
	(pph_implicit_class_cost): New.
	(pph_print_declaration): New.
	(pph_print_declarations): New.
	(pph_print_trees_tokens): New.
	(pph_catch_name_lookup): New.
	(pph_print_stats): New.
	(pph_init): New.
	(pph_finish): New.
	(c_parse_file): Call pph_init and pph_finish.
	* call.c (implicit_conversion): Call pph_catch_name_lookup.
	(build_new_op): Call pph_catch_name_lookup.
	(convert_like_real): Call pph_catch_name_lookup.
	(build_new_method_call): Call pph_catch_name_lookup.
	* cp-objcp-common.h (LANG_HOOKS_PPH_CATCH_TREE): Define.
	(LANG_HOOKS_PPH_UNCATCH_TREE): Define.
	* cp-tree.h (PPH_POP_TIMEVAR_AND_RETURN): Define.
	Replace every call to POP_TIMEVAR_AND_RETURN with
	PPH_POP_TIMEVAR_AND_RETURN.
	(pph_catch_tree): Declare.
	(pph_uncatch_tree): Declare.
	(pph_catch_name_lookup): Declare.
	* name-lookup.c: Include tree-pretty-print.h
	(add_decl_to_level): Add tracing for -fpph-debug.
